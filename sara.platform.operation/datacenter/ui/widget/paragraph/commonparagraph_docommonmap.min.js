function doCommonMap(n,t,i,r){this.bind=function(u){var e=t[i],f={},o=!0,s,h;_mapObjectHashMap==null?_mapObjectHashMap=new hashMap:_mapObjectHashMap.containsKey(n.paragraphid+"_"+e.targetdiv)&&(f=_mapObjectHashMap.get(n.paragraphid+"_"+e.targetdiv),o=!1);o&&(s=$("#div_"+n.paragraphid+">#div_row>#"+e.targetdiv+""),e.htmlclass!=""&&(h=s.attr("class"),h+=" "+e.htmlclass,s.attr("class",h)));initEsriObject({success:function(){if(o?f.mapControl=doViewLayers(f,e,s,r,n.paragraphid,e.targetdiv):setViewLayers(f,e,r,n.paragraphid,e.targetdiv),o)f.mapControl.on("load",function(){if(e.isdisable=="true")f.mapControl.disableScrollWheelZoom(),f.mapControl.disablePan(),f.mapControl.disableDoubleClickZoom(),f.mapControl.disableMapNavigation(),f.mapControl.hideZoomSlider();else{var n=getBrowerVersion();n.browser=="IE"&&f.mapControl.disableScrollWheelZoom()}});o||($.each(e.querylayers,function(n){e.querylayers[n].event=="cluster"&&f.mapControl.removeLayer(f.mapControl.getLayer(e.querylayers[n].id))}),f.mapControl.graphics.clear(),f.mapControl.setExtent(_esriObject.startExtent));doQueryLayers(f,e,r,n.paragraphid,e.targetdiv,{success:function(){_mapObjectHashMap.put(n.paragraphid+"_"+e.targetdiv,f);u.successHandler(n,t,i,r)}})}})}}function setViewLayers(n,t,i,r,u){var f=t.viewlayers,e=n.mapControl;$.each(f,function(n){var t=[];f[n].filter!=""&&(t=[],t[0]=initWhereStringByQueryParameterHashMap(i,f[n].filter.returnString(),r,u).returnString(),e.getLayer(f[n].id).setLayerDefinitions(t))})}function doViewLayers(n,t,i,r,u,f){var e=t.viewlayers,s,h,o,c;return e.sort(function(n,t){return Number(n.index)>Number(t.index)?1:-1}),s=new _esriObject.esriArcGISDynamicMapServiceLayer(addTokenToMapURL(e[0].url.returnString()),{id:e[0].id,visible:!0,opacity:e[0].opacity,copyright:"",description:"",disableClientCaching:!1,minScale:e[0].minScale}),h=new _esriObject.esriMap(i[0],{nav:!1,slider:!0,sliderPosition:"bottom-right",extent:_esriObject.startExtent,showAttribution:!1,showInfoWindowOnClick:!1,basemap:s,logo:!1}),h.addLayer(s),o=[],e[0].filter!=""&&(o=[],o[0]=initWhereStringByQueryParameterHashMap(r,e[0].filter.returnString(),u,f).returnString(),s.setLayerDefinitions(o)),c=null,$.each(e,function(n){n!=0&&(c=new _esriObject.esriArcGISDynamicMapServiceLayer(addTokenToMapURL(e[n].url.returnString()),{id:e[n].id,visible:!0,opacity:e[n].opacity,copyright:"",description:"",disableClientCaching:!1,minScale:e[n].minScale}),h.addLayer(c),e[n].filter!=""&&(o=[],o[0]=initWhereStringByQueryParameterHashMap(r,e[n].filter.returnString(),u,f).returnString(),c.setLayerDefinitions(o)))}),h}function doQueryLayers(n,t,i,r,u,f){if(t.querylayers!=undefined&&t.querylayers.length>0){var e=t.querylayers;e.sort(function(n,t){return Number(n.index)>Number(t.index)?1:-1});doQueryLayer(n,e,0,i,r,u,f)}else f.success()}function doQueryLayer(n,t,i,r,u,f,e){if(i==t.length)e.success();else{var o=t[i],h=new _esriObject.esriQueryTask(addTokenToMapURL(o.url.returnString())),s=new _esriObject.esriQuery;s.returnGeometry=!0;s.outFields=o.outFields==""?[]:o.outFields=="*"?["*"]:o.outFields.split("^");s.outSpatialReference={wkid:2384};switch(o.event){case"location":s.where=initWhereStringByQueryParameterHashMap(r,o.wherecause.returnString(),u,f).returnString();h.execute(s,function(c){var l=new _esriObject.esriExtent;$.each(c.features,function(n){var t=c.features[n];l=n==0?t.geometry.getExtent():l.union(t.geometry.getExtent())});n.mapControl.setExtent(l);l=null;s=null;h=null;c=null;o=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)},function(){s=null;h=null;o=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)});break;case"symbol":s.where=initWhereStringByQueryParameterHashMap(r,o.wherecause.returnString(),u,f).returnString();h.execute(s,function(c){var l=[],a;$.each(c.features,function(n){l.push(c.features[n].geometry)});l.length==1?(a=new _esriObject.esriGraphic,a.geometry=l[0],a.symbol=_esriObject.symbolHashMap.get(o.symbolname),n.mapControl.graphics.add(a),s=null,h=null,o=null,l=null,a=null,GC(),doQueryLayer(n,t,i+1,r,u,f,e)):l.length>1?_esriObject.geometryService.union(l,function(c){var a=new _esriObject.esriGraphic;a.geometry=c;a.symbol=_esriObject.symbolHashMap.get(o.symbolname);n.mapControl.graphics.add(a);s=null;h=null;o=null;l=null;c=null;a=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)},function(){s=null;h=null;o=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)}):(s=null,h=null,o=null,GC(),doQueryLayer(n,t,i+1,r,u,f,e))},function(){s=null;h=null;o=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)});break;case"cluster":s.where=initWhereStringByQueryParameterHashMap(r,o.wherecause.returnString(),u,f).returnString();h.execute(s,function(c){var v={},a;v.data=_esriObject.arrayUtils.map(c.features,function(n){return{x:n.geometry.x,y:n.geometry.y}});var y=new _esriObject.esriClusterLayer({data:v.data,distance:o.distance,id:o.id,labelColor:"#fff",labelOffset:10,resolution:n.mapControl.extent.getWidth()/n.mapControl.width,singleColor:"#888",maxSingles:2e3,issingleTemplate:"false"}),k=(new _esriObject.esriSimpleMarkerSymbol).setSize(4),l=new _esriObject.esriClassBreaksRenderer(k,"clusterCount"),p=new _esriObject.esriPictureMarkerSymbol(_picBaseUrl+"Point-BluePin1LargeB.png",64,64).setOffset(0,15),w=new _esriObject.esriPictureMarkerSymbol(_picBaseUrl+"Point-GreenPin1LargeB.png",72,72).setOffset(0,15),b=new _esriObject.esriPictureMarkerSymbol(_picBaseUrl+"Point-RedPin1LargeB.png",100,100).setOffset(0,15);o.render!=undefined?(a=o.render.split("^"),l.addBreak(a[0],a[1],p),l.addBreak(a[1],a[2],w),l.addBreak(a[2],a[3],b)):(l.addBreak(1,100,p),l.addBreak(100,500,w),l.addBreak(500,1e5,b));y.setRenderer(l);n.mapControl.addLayer(y);s=null;h=null;o=null;c=null;v=null;y=null;k=null;l=null;p=nulll;w=null;b=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)},function(){s=null;h=null;o=null;GC();doQueryLayer(n,t,i+1,r,u,f,e)})}}}function initEsriObject(n){_esriObject==null?(_esriObject={},require(["esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/tasks/GeometryService","esri/symbols/SimpleFillSymbol","esri/config","esri/tasks/query","esri/tasks/QueryTask","esri/graphic","dojo/_base/array","extras/ClusterLayer","esri/symbols/SimpleMarkerSymbol","esri/renderers/ClassBreaksRenderer","esri/symbols/PictureMarkerSymbol","esri/layers/FeatureLayer"],function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){_esriObject.esriMap=t;_esriObject.esriArcGISDynamicMapServiceLayer=i;_esriObject.esriGraphicsLayer=r;_esriObject.esriExtent=u;_esriObject.esriGeometryService=f;_esriObject.esriSimpleFillSymbol=e;_esriObject.esriConfig=o;_esriObject.esriQuery=s;_esriObject.esriQueryTask=h;_esriObject.esriGraphic=c;_esriObject.arrayUtils=l;_esriObject.esriClusterLayer=a;_esriObject.esriSimpleMarkerSymbol=v;_esriObject.esriClassBreaksRenderer=y;_esriObject.esriPictureMarkerSymbol=p;_esriObject.esriFeatureLayer=w;o.defaults.io.proxyUrl=_proxyUrl;o.defaults.io.timeout=_proxyTime;_esriObject.startExtent=new _esriObject.esriExtent({xmin:474048.3705,ymin:4269136.8986,xmax:591535.3561,ymax:4457576.1581,spatialReference:{wkid:2384}});var k=new _esriObject.esriSimpleFillSymbol(_esriObject.esriSimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([98,194,204]),.5),new dojo.Color([98,194,204,.5])),d=new _esriObject.esriSimpleFillSymbol(_esriObject.esriSimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,255,0]),4),new dojo.Color([255,0,0,.9])),g=new _esriObject.esriSimpleFillSymbol(_esriObject.esriSimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new dojo.Color([255,255,0]),2),new dojo.Color([255,0,0,.6])),nt=new _esriObject.esriSimpleFillSymbol(_esriObject.esriSimpleFillSymbol.STYLE_NONE,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,.25])),b=new hashMap;b.put("defaultSymbol",k);b.put("highLightSymbol",d);b.put("querySymbol",g);b.put("drawSymbol",nt);_esriObject.symbolHashMap=b;_esriObject.geometryService=new _esriObject.esriGeometryService(addTokenToMapURL(_geometryServiceUrl));n.success()})):n.success()}var _esriObject=null,_mapObjectHashMap=null,_picBaseUrl="//127.0.0.1/sara.dd.ldsw/images/";
