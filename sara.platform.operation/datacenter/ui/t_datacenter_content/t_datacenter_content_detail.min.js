var _pr_fromurl="",_pr_fromurlparam="",_pr_appcode="",_clientInf='{userid:"",appcode:"",appname:"",userip:"",usermac:"",username:"",userimg:""}',_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,t_datacenter_content_detail_obj=function(){"use strict";var t="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/datacenter/service/service_t_datacenter_content.asmx/",i="//127.0.0.1/sara.dd.ldsw.file/files_content/",u=function(t){try{_pr_fromurl=requestQuery("fromurl");_pr_fromurlparam=requestQuery("fromurlparam");n._pr_tablename=requestQuery("tablename");n._pr_pagetype=requestQuery("pagetype");_pr_appcode=requestQuery("appcode");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'",userimg:"'+basePageObj._userInfoJson.sys_photourl+'"}';n._pr_pagetype==null||n._pr_pagetype==""?_blockMessage.show("_pr_pagetype参数接收失败...","fail"):t.success()}catch(i){_blockMessage.show("initParameter执行失败"+i.message,"fail")}},f=function(n){n.success()},e=function(n){try{controlObj.fileuploaderinit("detail_fileuploader",{fileUploadRootPath:i,isMultiple:!1,fileUploadExtnames:";.xlsx;.xls;",extName:"t_datacenter_content",fileUploadCountMax:1,isRealName:!0,isCanDelete:"2",isCanDownload:"2",onAllUploadEnd:function(){var n=controlObj.fileuploadercontent("detail_fileuploader");$("#detail_filecontent").html(n[0].fileuploadname);doAjaxFunction(t+"ReadExcel",{filepath:i+"fileuploadpath/",filename:n[0].fileuploadname,clientInf:_clientInf},{success:function(n){n=$.parseJSON(n);var t=r(n);$("#t_datacenter_content_detail_newdatatable").html(t);o()?(_alertMessage.show("文件上传成功，请选择继续操作","success"),$("#div_t_datacenter_content_imp2database").removeAttr("disabled")):_alertMessage.show("上传数据与表结构不一致，请重新上传","fail")},fail:function(n){_alertMessage.show("操作失败"+n,"fail")}});controlObj.fileuploaderbind("detail_fileuploader",[])}});controlObj.toggleinit("detail_checkbox");n.success()}catch(u){_blockMessage.show("initControl执行失败。<br/>"+u.message,"fail")}},o=function(){var i,r,t;return n._pr_pagetype==="0"?!0:(i=[],$("#t_datacenter_content_detail_newdatatable table thead tr").first().find("th").each(function(){i.push($(this).text())}),r=[],$("#t_datacenter_content_detail_datatable table thead tr").first().find("th").each(function(){r.push($(this).text())}),t=!0,$.each(i,function(n,i){if(r.indexOf(i)==-1)return t=!1,!1}),t&&$.each(r,function(n,r){if(i.indexOf(r)==-1)return t=!1,!1}),t)},h=function(n){try{n?$(".btn-command-message").attr("disabled","disabled"):$(".btn-command-message").removeAttr("disabled")}catch(t){_blockMessage.show("setDisable执行失败。<br/>"+t.message,"fail")}},c=function(n,t){t.success()},s=function(i,r){var u={tablename:n._pr_tablename,isAll:i||"false",clientInf:_clientInf};doAjaxFunction(t,"GetData",u,{success:function(n){var t=new Function("","return "+n)();r.success(t)},fail:function(n){_blockMessage.show(t+"GetList<br/>"+n,"fail")}})},r=function(n){var t=[];return t.push('<table class="table table-striped table-bordered table-hover">'),t.push("<thead>"),t.push("<tr>"),$.each(n[0],function(n,i){t.push("<th>",i,"<\/th>")}),t.push("<\/tr>"),t.push("<\/thead>"),n.shift(),t.push("<tbody>"),$.each(n,function(n,i){t.push("<tr>");$.each(i,function(n,i){t.push("<td>",i,"<\/td>")});t.push("<\/tr>")}),t.push("<\/tbody>"),t.push("<\/table>"),t.join("")},n={_pr_tablename:"",_pr_pagetype:"",init:function(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");basePageObj.initBasePage({success:function(){u({success:function(){f({success:function(){e({success:function(){switch(n._pr_pagetype){case"0":$("#div_t_datacenter_content_tablename").find("h2").addClass("hidden").end().find("#div_input_tablename").removeClass("hidden");$("#div_tablecontent_olddata").addClass("hidden");_blockMessage.hidden();break;case"1":n.bindPage("false",{success:function(){_blockMessage.hidden();$("#div_t_datacenter_content_tablename h2,#input_tablename_t_datacenter_content").html(n._pr_tablename)}});break;case"2":n.bindPage("false",{success:function(){_blockMessage.hidden();$("#div_t_datacenter_content_tablename h2,#input_tablename_t_datacenter_content").html(n._pr_tablename);$("#div_pagetype1_command").addClass("hidden");$("#div_tablecontent_newdata").addClass("hidden")}})}}})}})}})},fail:function(n){_blockMessage.show(n,"fail")}})}catch(t){_blockMessage.show("程序初始化失败。<br/>"+t.message,"fail")}},bindPage:function(n,t){try{s(n,{success:function(n){n.length===21&&$("#div_t_datacenter_content_loadmore").removeClass("hidden");$("#t_datacenter_content_detail_datatable").html(r(n));t.success()}})}catch(i){_blockMessage.show("bindPage执行失败。<br/>"+i.message,"fail")}},btn_command_cancle_onclick:function(){var n=_pr_fromurl,t;n+="?uid="+basePageObj._userInfoJson.sys_userid;t=new Function("","return "+_pr_fromurlparam)();$.each(t,function(t,i){n+=typeof i=="object"?"&"+t+"="+JSON.stringify(i):"&"+t+"="+i});commonObj.changeUrl(n,"right-hide")},loadmoredata:function(){var t="<blockquote> ";t+='<h3>根据数据库表中的数据量，本操作可能会导致后台无法及时响应，需要耐心等待后台数据返回，并且如果数据量巨大，可能会导致浏览器<a style="color:red">假死<\/a>以及<a style="color:red">卡顿<\/a><\/h3>';t+="<h5>请确认操作<\/h5>";t+="<\/blockquote> ";_confirmMessage.destory();_confirmMessage.show("操作确认？",t,{confirm:function(){_blockMessage.show("正在执行查询，请稍后。。。","loadingcenter");n.bindPage("true",{success:function(){$("#div_t_datacenter_content_loadmore").addClass("hidden");_blockMessage.hidden()}})},cancle:function(){_alertMessage.show("操作已取消","success",1e3)}})},imp2database_onclick:function(){var r="",u="false";switch(n._pr_pagetype){case"0":if(r=controlObj.text("input_tablename_t_datacenter_content"),u="true",!r){_alertMessage.show("表名不得为空","warning");return}r="t_datacenter_content"+String(r).toUpperCase();break;case"1":u="false";r=n._pr_tablename}doAjaxFunction(t+"ImpData2DataBaseByExcel",{tablename:r,iscreate:u,isclear:controlObj.toggle("detail_checkbox"),filename:$("#detail_filecontent").html(),filepath:i+"fileuploadpath/",clientInf:_clientInf},{success:function(t){if(t)_alertMessage.show("操作失败："+t,"warning");else{if(n._pr_pagetype==="0"){window.location.href=window.location.href.replace("pagetype=0","pagetype=1").replace("tablename="+n._pr_tablename,"tablename="+r);return}n._pr_tablename=r;n.bindPage("false",{success:function(){_alertMessage.show("操作成功","success",3e3)},fail:function(n){_alertMessage.show("导入数据库操作失败"+n,"fail")}})}},fail:function(n){_alertMessage.show("导入数据库操作失败"+n,"fail")}})}};return n}();$(document).ready(function(){t_datacenter_content_detail_obj.init()});
