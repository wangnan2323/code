var _pr_appcode="",_clientInf='{userid:"",appcode:"",appname:"",userip:"",usermac:"",username:""}',_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,t_codeObj=function(){function h(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");basePageObj.initBasePage({success:function(){c({success:function(){i();$("#div_code_menu_detail").load("../t_code/t_code_menu_detail_part.html",null,function(){t_code_menu_detail_Obj._pr_pagetype=t.pagetype;t_code_menu_detail_Obj._pr_nodeid="";t_code_menu_detail_Obj.init({success:function(){$("#div_code_content_modallist").load("../t_code/t_code_content_modallist_part.html",null,function(){t_code_content_modallist_Obj._pr_listtype=t.pagetype;t_code_content_modallist_Obj.menuid="";t_code_content_modallist_Obj.init({success:function(){_blockMessage.hidden()}})})}})})}})},fail:function(n){_blockMessage.show(n,"fail")}})}catch(n){_blockMessage.show("程序初始化失败。<br/>"+n.message,"fail")}}function c(i){if(t.pagetype=requestQuery("pagetype"),_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'"}',n=requestQuery("appname")||n,n==""){_blockMessage.show("appname参数初始化失败。。。","fail");return}if(!t.pagetype){_blockMessage.show("pagetype参数初始化失败。。。","fail");return}i&&i.success&&i.success()}function i(t){doAjaxFunction(s,"GetList",{whereString:"appname = '"+n+"'",orderByString:"",columnsString:"id^nodeid^nodename^parentnodeid^parentnodename^nodeclass^nodelayer^nodetype^nodetable^nodeoperpage^appname",pageSizeString:"",pageIndexString:"",clientInf:_clientInf},{success:function(i){var e=JSON.parse(i).rows,s,r,o;Array.prototype.sort.call(e,function(n,t){return+n.nodeid>+t.nodeid?u:-u});s=4;r=[];r.push('<li class="parent_li">');t?r.push("<span >"):r.push('<span class="bg-warning">');r.push('<i class="icon-folder-open"  onclick="t_codeObj.tree_edit_onclick(event,this,\'\')">');r.push("<a>"+n+"<\/a>");r.push("<\/i>");r.push('<i class="glyphicon glyphicon-edit left20 hand" onclick="t_codeObj.tree_edit_onclick(event,this,\'\')"><\/i>');r.push("<\/span>");r.push("<ul>");r=r.concat(f(t,e,4));r.push("<\/ul>");r.push("<\/li>");o=$("#ul_treeroot");o.html(r.join(""))},fail:function(){}})}function f(n,t,i,u){i||(i=4);u||(u=[]);var e=i+4,o=[],s=[],h=[];return $.each(t,function(n,t){t.nodeid.toString().length===+i?o.push(t):t.nodeid.toString().length===+e?s.push(t):h.push(t)}),$.each(o,function(t,i){var o=$.grep(s,function(n){return n.parentnodeid===i.nodeid});u.push("<li>");u.push('<span id="nodeid_'+i.nodeid+'" nodeid="'+i.nodeid+'" nodename="'+i.nodename+'"  parentnodeid="'+i.parentnodeid+'" parentnodename="'+i.parentnodename+'" '+(n==i.nodeid?'class="bg-warning"':"")+">");o.length>0?u.push('<i class="hand icon-'+(!r||n&&n.indexOf(i.nodeid)==0&&n!=i.nodeid?"minus":"plus")+'-sign" onclick="t_codeObj.tree_folder_onclick(event,this,\''+i.nodeid+"')\">"):u.push('<i class="hand icon-leaf" onclick="t_codeObj.tree_edit_onclick(event,this,\''+i.nodeid+"')\">");u.push('<a title="'+i.nodename+'" >');u.push(i.nodename);u.push("<\/a>");u.push("<\/i>");u.push('<i class="glyphicon glyphicon-edit left20 hand" onclick="t_codeObj.tree_edit_onclick(event,this,\''+i.nodeid+"')\">");u.push("<\/i>");u.push("<\/span>");o.length>0&&(!r||n&&n.indexOf(i.nodeid)==0&&n!=i.nodeid?u.push("<ul>"):u.push('<ul style="display:none">'),u=u.concat(f(n,o.concat(h),e)),u.push("<\/ul>"));u.push("<\/li>")}),u}function l(n,t,i){var r=$(t),u=r.parent("span").next("ul");u.is(":visible")?(r.addClass("icon-plus-sign").removeClass("icon-minus-sign"),u.hide("fast")):(r.removeClass("icon-plus-sign").addClass("icon-minus-sign"),u.show("fast"));e(n,t,i)}function a(n){var i=$("#ul_treeroot"),t;i.find("span").removeClass("bg-warning");t=$(n);t.parent().addClass("bg-warning")}function e(n,t,i){a(t);i=i||"";t_code_menu_detail_Obj&&(t_code_menu_detail_Obj._pr_nodeid=i,t_code_menu_detail_Obj.bindPage({success:function(){}}));t_code_content_modallist_Obj&&(t_code_content_modallist_Obj.menuid=i||"",t_code_content_modallist_Obj._pr_gridselectids="",t_code_content_modallist_Obj.bindGrid({success:function(){}}))}var r=!1,u=-1,o=[{id:"1",text:"是"},{id:"2",text:"否"}],n="",s="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/code/service/service_t_code_menu.asmx/",t={init:h,pagetype:"",tree_folder_onclick:l,tree_edit_onclick:e,load_tree:i,getcurrentselectednode:function(){return $("#ul_treeroot").find("span.bg-warning")},getAppname:function(){return n},getSfData:function(){return o},reload_all:function(n){i(n);t_code_content_modallist_Obj.menuid=n;t_code_content_modallist_Obj.bindGrid({success:function(){}});t_code_menu_detail_Obj._pr_nodeid=n;t_code_menu_detail_Obj.bindPage({success:function(){}})}};return t}();$(function(){t_codeObj.init()});
