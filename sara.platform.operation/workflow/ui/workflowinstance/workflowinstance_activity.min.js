function initActivity(){initControl();bindActivityData();bindWorkitemList(10,1)}function bindActivityData(){$("#txt_sys_id").val(_currentActivity.id);$("#txt_sys_orderid").val(_currentActivity.sys_orderid);$("#txt_f_dy_jd_sys_version").val(_currentActivity.f_dy_jd_sys_version);$("#txt_f_dy_jd_sys_remark").val(_currentActivity.f_dy_jd_sys_remark);$("#txt_fk_dy_jd_sys_id").val(_currentActivity.fk_dy_jd_sys_id);$("#txt_fk_dy_lc_sys_id").val(_currentActivity.fk_dy_lc_sys_id);$("#txt_fk_sl_lc_sys_id").val(_currentProcess.process.id);$("#txt_fk_dy_yy_sys_id").val(_currentActivity.fk_dy_yy_sys_id);$("#txt_fk_sl_yy_sys_id").val(_currentActivity.fk_sl_yy_sys_id);$("#txt_jdmc").val(_currentActivity.jdmc);$("#txt_jdslmc").val(_currentActivity.jdslmc);$("#txt_jdms").val(_currentActivity.jdms);$("#txt_jdlx").combobox("select",_currentActivity.jdlx);$("#txt_jdnyh").combobox("select",_currentActivity.jdnyh);$("#txt_jdthms").combobox("select",_currentActivity.jdthms);$("#txt_sfszlcjd").combobox("select",_currentActivity.sfszlcjd);$("#txt_sfhyzlc").combobox("select",_currentActivity.sfhyzlc);$("#txt_sfsfzjd").combobox("select",_currentActivity.sfsfzjd);$("#txt_zlcdyid").val(_currentActivity.zlcdyid);$("#txt_zlcslid").val(_currentActivity.zlcslid);$("#txt_zb").val(_currentActivity.x+"_"+_currentActivity.y+"_"+_currentActivity.width+"_"+_currentActivity.height);$("#txt_jdsx").val(_currentActivity.jdsx);$("#txt_sfbqh").combobox("select",_currentActivity.sfbqh);$("#txt_czryid").val(_currentActivity.czryid);$("#txt_czrygz").combobox("select",_currentActivity.czrygz);$("#txt_jdzt").combobox("select",_currentActivity.jdzt);_currentActivity.kssj!=""&&Date.parse(_currentActivity.kssj)!=Date.parse("1900/1/1")&&($("#txt_kssj").datebox("setValue",new Date(_currentActivity.kssj).Format("yyyy-MM-dd")),$("#txt_kssj").datebox("calendar").calendar("moveTo",new Date(_currentActivity.kssj)));_currentActivity.fsqhsj!=""&&Date.parse(_currentActivity.fsqhsj)!=Date.parse("1900/1/1")&&($("#txt_fsqhsj").datebox("setValue",new Date(_currentActivity.fsqhsj).Format("yyyy-MM-dd")),$("#txt_fsqhsj").datebox("calendar").calendar("moveTo",new Date(_currentActivity.fsqhsj)));_currentActivity.bthsj!=""&&Date.parse(_currentActivity.bthsj)!=Date.parse("1900/1/1")&&($("#txt_bthsj").datebox("setValue",new Date(_currentActivity.bthsj).Format("yyyy-MM-dd")),$("#txt_bthsj").datebox("calendar").calendar("moveTo",new Date(_currentActivity.bthsj)));_currentActivity.fsthsj!=""&&Date.parse(_currentActivity.fsthsj)!=Date.parse("1900/1/1")&&($("#txt_fsthsj").datebox("setValue",new Date(_currentActivity.fsthsj).Format("yyyy-MM-dd")),$("#txt_fsthsj").datebox("calendar").calendar("moveTo",new Date(_currentActivity.fsthsj)));_currentActivity.jssj!=""&&Date.parse(_currentActivity.jssj)!=Date.parse("1900/1/1")&&($("#txt_jssj").datebox("setValue",new Date(_currentActivity.jssj).Format("yyyy-MM-dd")),$("#txt_jssj").datebox("calendar").calendar("moveTo",new Date(_currentActivity.jssj)))}function initControl(){$("#div_detail_t_workitem").window({width:800,height:600,modal:!0,title:"workitem",collapsible:!1,minimizable:!1,maximizable:!0,closable:!1,closed:!0,draggable:!0,resizable:!0,shadow:!0});$("#div_detail_t_workitem").window("close");$("#txt_jdlx").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"开始节点"},{value:"1",label:"过程一般节点"},{value:"2",label:"过程选择节点"},{value:"3",label:"过程聚合节点"},{value:"4",label:"过程聚合选择节点"},{value:"5",label:"结束节点"}],valueField:"value",textField:"label"});$("#txt_jdnyh").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"没有用户"},{value:"1",label:"一个用户"},{value:"2",label:"多个用户[串行]"},{value:"3",label:"多个用户[并行]"},{value:"4",label:"多个用户[竞争]"}],valueField:"value",textField:"label"});$("#txt_jdthms").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"返回+正常流转"},{value:"1",label:"返回"},{value:"2",label:"正常流转"}],valueField:"value",textField:"label"});$("#txt_sfszlcjd").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfhyzlc").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfsfzjd").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfbqh").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_czrygz").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"用户id"},{value:"1",label:"角色id"},{value:"2",label:"岗位id"},{value:"3",label:"机构id"}],valueField:"value",textField:"label"});$("#txt_jdzt").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"未通过"},{value:"1",label:"进行中"},{value:"2",label:"已通过"},{value:"3",label:"发生取回"},{value:"4",label:"发生取回通过"},{value:"5",label:"被退回"},{value:"6",label:"被退回通过[返回]"},{value:"7",label:"发生退回"},{value:"8",label:"发生退回通过"},{value:"9",label:"发生驳回"}],valueField:"value",textField:"label"});var n=10;$("#table_datagrid_t_workitem").datagrid({fitColumns:!0,pagination:!0,singleSelect:!0,checkOnSelect:!1,selectOnCheck:!1,pageList:[n],pageSize:n,loadMsg:"数据装载中......",fit:!0,rownumbers:!0,columns:[[{field:"sys_id",title:"sys_id",width:5},{field:"cjsj",title:"创建时间",width:5},{field:"sys_id_from",title:"前驱workitemid",width:5},{field:"czrname",title:"操作人name",width:5},{field:"jdslmc",title:"节点实例名称",width:5},{field:"sys_id1",title:"操作",formatter:edit_button_t_workitem_formatter,width:5}]]});$("#table_datagrid_t_workitem").datagrid("getPager").pagination({onSelectPage:function(n,t){bindData(t,n)},beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录   共 {total} 条记录"});$("#txt_t_workitem_xszt").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"待办，可被取回"},{value:"1",label:"待办，不可被取回"},{value:"2",label:"办理完成，[可取回]"},{value:"3",label:"办理完成；不可取回下一条记录"},{value:"4",label:"前一条记录被取回，当前记录作废"},{value:"5",label:"当前记录发生取回，后一条记录作废"},{value:"6",label:"串行等待状态"},{value:"7",label:"竞争完结状态"},{value:"8",label:"因退回而造成的熄灭状态[可取回]"},{value:"9",label:"因驳回回而造成的结束状态"},{value:"10",label:"因退回回而造成的结束状态"}],valueField:"value",textField:"label"});$("#txt_t_workitem_lx").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"没有用户"},{value:"1",label:"一个用户"},{value:"2",label:"多个用户[串行]"},{value:"3",label:"多个用户[并行]"},{value:"4",label:"多个用户[竞争]"}],valueField:"value",textField:"label"});$("#txt_t_workitem_dbzt").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"节点间后继产生的待办"},{value:"1",label:"节点间退回产生的待办"},{value:"2",label:"节点间返回产生的待办"},{value:"3",label:"节点内后继产生的待办"},{value:"4",label:"节点内退回产生的待办"},{value:"5",label:"节点内返回产生的待办"}],valueField:"value",textField:"label"});$("#txt_t_workitem_sfbqh").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"})}function btn_save_activity(){_currentActivity.id=$("#txt_sys_id").val();_currentActivity.sys_orderid=$("#txt_sys_orderid").val();_currentActivity.f_dy_jd_sys_version=$("#txt_f_dy_jd_sys_version").val();_currentActivity.f_dy_jd_sys_remark=$("#txt_f_dy_jd_sys_remark").val();_currentActivity.fk_dy_jd_sys_id=$("#txt_fk_dy_jd_sys_id").val();_currentActivity.fk_dy_lc_sys_id=$("#txt_fk_dy_lc_sys_id").val();_currentActivity.fk_sl_lc_sys_id=$("#txt_fk_sl_lc_sys_id").val();_currentActivity.fk_dy_yy_sys_id=$("#txt_fk_dy_yy_sys_id").val();_currentActivity.fk_sl_yy_sys_id=$("#txt_fk_sl_yy_sys_id").val();_currentActivity.jdmc=$("#txt_jdmc").val();_currentActivity.jdslmc=$("#txt_jdslmc").val();_currentActivity.jdms=$("#txt_jdms").val();_currentActivity.jdlx=$("#txt_jdlx").combo("getValue");_currentActivity.jdnyh=$("#txt_jdnyh").combo("getValue");_currentActivity.jdthms=$("#txt_jdthms").combo("getValue");_currentActivity.sfszlcjd=$("#txt_sfszlcjd").combo("getValue");_currentActivity.sfhyzlc=$("#txt_sfhyzlc").combo("getValue");_currentActivity.sfsfzjd=$("#txt_sfsfzjd").combo("getValue");_currentActivity.zlcdyid=$("#txt_zlcdyid").val();_currentActivity.zlcslid=$("#txt_zlcslid").val();_currentActivity.zb=$("#txt_zb").val();_currentActivity.jdsx=$("#txt_jdsx").val();_currentActivity.sfbqh=$("#txt_sfbqh").combo("getValue");_currentActivity.czryid=$("#txt_czryid").val();_currentActivity.czrygz=$("#txt_czrygz").combo("getValue");_currentActivity.jdzt=$("#txt_jdzt").combo("getValue");_currentActivity.kssj=$("#txt_kssj").datebox("getValue");_currentActivity.fsqhsj=$("#txt_fsqhsj").datebox("getValue");_currentActivity.bthsj=$("#txt_bthsj").datebox("getValue");_currentActivity.fsthsj=$("#txt_fsthsj").datebox("getValue");_currentActivity.jssj=$("#txt_jssj").datebox("getValue");_currentActivity.setContent(_currentActivity.id+"<br/>"+_currentActivity.jdmc);var n=_currentActivity.toJsonString(),t='{"columns":\'sys_id^sys_orderid^f_dy_jd_sys_version^f_dy_jd_sys_remark^fk_dy_jd_sys_id^fk_dy_lc_sys_id^fk_sl_lc_sys_id^fk_dy_yy_sys_id^fk_sl_yy_sys_id^jdmc^jdslmc^jdms^jdlx^jdnyh^jdthms^sfszlcjd^sfhyzlc^sfsfzjd^zlcdyid^zlcslid^zb^jdsx^sfbqh^czryid^czrygz^jdzt^kssj^fsqhsj^bthsj^fsthsj^jssj\',"clientInf":\''+_clientInf+"',\"json\":'"+n+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"Update",data:t,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?showMessage("保存成功。","result","window"):showMessage("保存失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window")},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function bindWorkitemList(n,t){var i="fk_sl_jd_sys_id = '"+_currentActivity.id+"'",r=n,u=t,f='{"whereString":\''+i.formatString()+"',\"orderByString\":' sys_id desc',\"columnsString\":'sys_id^sys_orderid^xszt^lx^dbzt^cjsj^qssj^qhsj^bjsj^sys_id_to^sys_id_from^czrid^czrname^jdslmc',\"pageSizeString\":'"+r+"',\"pageIndexString\":'"+u+"',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceWorkItemUrl+"GetList",data:f,dataType:"json",success:function(n){var t=new Function("","return "+n.d)(),i;t.result=="true"?(i=new Function("","return "+t.message)(),$("#table_datagrid_t_workitem").datagrid("loadData",i)):alert(t.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function edit_button_t_workitem_formatter(n,t){return"<a href='javascript:void(0);' onclick='edit_button_t_workitem_onclick(\""+t.sys_id+"\")'>编辑<\/a>"}function edit_button_t_workitem_onclick(n){$("#div_detail_t_workitem").window("open");_workitem_sys_id=n;var t="sys_id=‘"+n+"’",i='{"whereString":\''+t+"',\"orderByString\":'',\"columnsString\":'sys_id^sys_orderid^xszt^lx^dbzt^fk_dy_jd_sys_id^fk_sl_jd_sys_id^fk_dy_lc_sys_id^fk_sl_lc_sys_id^fk_dy_yy_sys_id^fk_sl_yy_sys_id^fk_dy_ljx_sys_id^fk_sl_ljx_sys_id^cjsj^qssj^qhsj^bjsj^sys_id_to^sys_id_from^czrid^czrname^zlcdyid^zlcslid^sfbqh^czsx^jdslmc^jdms',\"pageSizeString\":'',\"pageIndexString\":'',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceWorkItemUrl+"GetList",data:i,dataType:"json",success:function(n){var i=new Function("","return "+n.d)(),t;i.result=="true"?(t=new Function("","return "+i.message)(),t.total==1&&($("#txt_t_workitem_sys_id").val(t.rows[0].sys_id),$("#txt_t_workitem_sys_orderid").val(t.rows[0].sys_orderid),$("#txt_t_workitem_xszt").combobox("select",t.rows[0].xszt),$("#txt_t_workitem_lx").combobox("select",t.rows[0].lx),$("#txt_t_workitem_dbzt").combobox("select",t.rows[0].dbzt),$("#txt_t_workitem_fk_dy_jd_sys_id").val(t.rows[0].fk_dy_jd_sys_id),$("#txt_t_workitem_fk_sl_jd_sys_id").val(t.rows[0].fk_sl_jd_sys_id),$("#txt_t_workitem_fk_dy_lc_sys_id").val(t.rows[0].fk_dy_lc_sys_id),$("#txt_t_workitem_fk_sl_lc_sys_id").val(t.rows[0].fk_sl_lc_sys_id),$("#txt_t_workitem_fk_dy_yy_sys_id").val(t.rows[0].fk_dy_yy_sys_id),$("#txt_t_workitem_fk_sl_yy_sys_id").val(t.rows[0].fk_sl_yy_sys_id),$("#txt_t_workitem_fk_dy_ljx_sys_id").val(t.rows[0].fk_dy_ljx_sys_id),$("#txt_t_workitem_fk_sl_ljx_sys_id").val(t.rows[0].fk_sl_ljx_sys_id),t.rows[0].cjsj!=""&&Date.parse(t.rows[0].cjsj)!=Date.parse("1900/1/1")&&($("#txt_t_workitem_cjsj").datebox("setValue",new Date(t.rows[0].cjsj).Format("yyyy-MM-dd")),$("#txt_t_workitem_cjsj").datebox("calendar").calendar("moveTo",new Date(t.rows[0].cjsj))),t.rows[0].qssj!=""&&Date.parse(t.rows[0].qssj)!=Date.parse("1900/1/1")&&($("#txt_t_workitem_qssj").datebox("setValue",new Date(t.rows[0].qssj).Format("yyyy-MM-dd")),$("#txt_t_workitem_qssj").datebox("calendar").calendar("moveTo",new Date(t.rows[0].qssj))),t.rows[0].qhsj!=""&&Date.parse(t.rows[0].qhsj)!=Date.parse("1900/1/1")&&($("#txt_t_workitem_qhsj").datebox("setValue",new Date(t.rows[0].qhsj).Format("yyyy-MM-dd")),$("#txt_t_workitem_qhsj").datebox("calendar").calendar("moveTo",new Date(t.rows[0].qhsj))),t.rows[0].bjsj!=""&&Date.parse(t.rows[0].bjsj)!=Date.parse("1900/1/1")&&($("#txt_t_workitem_bjsj").datebox("setValue",new Date(t.rows[0].bjsj).Format("yyyy-MM-dd")),$("#txt_t_workitem_bjsj").datebox("calendar").calendar("moveTo",new Date(t.rows[0].bjsj))),$("#txt_t_workitem_sys_id_to").val(t.rows[0].sys_id_to),$("#txt_t_workitem_sys_id_from").val(t.rows[0].sys_id_from),$("#txt_t_workitem_czrid").val(t.rows[0].czrid),$("#txt_t_workitem_czrname").val(t.rows[0].czrname),$("#txt_t_workitem_zlcdyid").val(t.rows[0].zlcdyid),$("#txt_t_workitem_zlcslid").val(t.rows[0].zlcslid),$("#txt_t_workitem_sfbqh").combobox("select",t.rows[0].sfbqh),$("#txt_t_workitem_czsx").val(t.rows[0].czsx),$("#txt_t_workitem_jdslmc").val(t.rows[0].jdslmc),$("#txt_t_workitem_jdms").val(t.rows[0].jdms))):alert(i.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_update_t_workitem_onclick(){var i=new Date,n='{"sys_id":"'+_workitem_sys_id+'",',t;n+='"sys_orderid":"'+$("#txt_t_workitem_sys_orderid").val()+'",';n+='"xszt":"'+$("#txt_t_workitem_xszt").combo("getValue")+'",';n+='"lx":"'+$("#txt_t_workitem_lx").combo("getValue")+'",';n+='"dbzt":"'+$("#txt_t_workitem_dbzt").combo("getValue")+'",';n+='"fk_dy_jd_sys_id":"'+$("#txt_t_workitem_fk_dy_jd_sys_id").val()+'",';n+='"fk_sl_jd_sys_id":"'+$("#txt_t_workitem_fk_sl_jd_sys_id").val()+'",';n+='"fk_dy_lc_sys_id":"'+$("#txt_t_workitem_fk_dy_lc_sys_id").val()+'",';n+='"fk_sl_lc_sys_id":"'+$("#txt_t_workitem_fk_sl_lc_sys_id").val()+'",';n+='"fk_dy_yy_sys_id":"'+$("#txt_t_workitem_fk_dy_yy_sys_id").val()+'",';n+='"fk_sl_yy_sys_id":"'+$("#txt_t_workitem_fk_sl_yy_sys_id").val()+'",';n+='"fk_dy_ljx_sys_id":"'+$("#txt_t_workitem_fk_dy_ljx_sys_id").val()+'",';n+='"fk_sl_ljx_sys_id":"'+$("#txt_t_workitem_fk_sl_ljx_sys_id").val()+'",';n+='"cjsj":"'+$("#txt_t_workitem_cjsj").datebox("getValue")+'",';n+='"qssj":"'+$("#txt_t_workitem_qssj").datebox("getValue")+'",';n+='"qhsj":"'+$("#txt_t_workitem_qhsj").datebox("getValue")+'",';n+='"bjsj":"'+$("#txt_t_workitem_bjsj").datebox("getValue")+'",';n+='"sys_id_to":"'+$("#txt_t_workitem_sys_id_to").val()+'",';n+='"sys_id_from":"'+$("#txt_t_workitem_sys_id_from").val()+'",';n+='"czrid":"'+$("#txt_t_workitem_czrid").val()+'",';n+='"czrname":"'+$("#txt_t_workitem_czrname").val()+'",';n+='"zlcdyid":"'+$("#txt_t_workitem_zlcdyid").val()+'",';n+='"zlcslid":"'+$("#txt_t_workitem_zlcslid").val()+'",';n+='"sfbqh":"'+$("#txt_t_workitem_sfbqh").combo("getValue")+'",';n+='"czsx":"'+$("#txt_t_workitem_czsx").val()+'",';n+='"jdslmc":"'+$("#txt_t_workitem_jdslmc").val()+'",';n+='"jdms":"'+$("#txt_t_workitem_jdms").val()+'"';n+="}";t='{"columns":\'sys_id^sys_orderid^xszt^lx^dbzt^fk_dy_jd_sys_id^fk_sl_jd_sys_id^fk_dy_lc_sys_id^fk_sl_lc_sys_id^fk_dy_yy_sys_id^fk_sl_yy_sys_id^fk_dy_ljx_sys_id^fk_sl_ljx_sys_id^cjsj^qssj^qhsj^bjsj^sys_id_to^sys_id_from^czrid^czrname^zlcdyid^zlcslid^sfbqh^czsx^jdslmc^jdms\',"clientInf":\''+_clientInf+"',\"json\":'"+n+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceWorkItemUrl+"Update",data:t,dataType:"json",success:function(n){var t=new Function("","return "+n.d)(),i;t.result=="true"?(i=new Function("","return "+t.message)(),showMessage("保存成功。","result","window")):showMessage("保存失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window")},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_cancle_t_workitem_onclick(){bindWorkitemList(10,1);$("#div_detail_t_workitem").window("close")}var _workitem_sys_id="";
