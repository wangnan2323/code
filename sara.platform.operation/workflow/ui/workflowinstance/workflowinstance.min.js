function openProcessProperties(){openType="process";_isOpenPropertiesPanel||_designerMain.layout("expand","east");_propertiesPanelObj.panel("refresh","workflowinstance_process.html")}function openActivityProperties(n){openType="activity";_isOpenPropertiesPanel||_designerMain.layout("expand","east");_currentActivity=n;_propertiesPanelObj.panel("refresh","workflowinstance_activity.html")}function openConnectionProperties(n){openType="connection";_isOpenPropertiesPanel||_designerMain.layout("expand","east");_currentConnection=n;_propertiesPanelObj.panel("refresh","workflowinstance_connection.html")}function bindData(){try{var n="sys_id=‘"+_sys_id+"’",t="",i="sys_version^sys_remark^fk_dy_lc_sys_id^lcmc^lcslmc^lcms^lcsx^sfzlc^flcjddyid^flcjdslid^lcksjddyid^lcksjdslid^lcjsjddyid^lcjsjdslid^ywbmc^ywbzjmc^ywbzjz^lcslzt^qdrid^qdrxm^qdsj^jsrid^jsrxm^jssj^jsbz^sys_id",r="",u="",f='{"whereString":\''+n+"',\"orderByString\":'"+t+"',\"columnsString\":'"+i+"',\"pageSizeString\":'"+r+"',\"pageIndexString\":'"+u+"',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceProcessUrl+"GetList",data:f,dataType:"json",success:function(n){var i=new Function("","return "+n.d)(),t;i.result=="true"?(t=new Function("","return "+i.message)(),t.total==1&&(_currentProcess.process.id=t.rows[0].sys_id,_currentProcess.process.sys_version=t.rows[0].sys_version,_currentProcess.process.sys_remark=t.rows[0].sys_remark,_currentProcess.process.fk_dy_lc_sys_id=t.rows[0].fk_dy_lc_sys_id,_currentProcess.process.lcmc=t.rows[0].lcmc,_currentProcess.process.lcslmc=t.rows[0].lcslmc,_currentProcess.process.lcms=t.rows[0].lcms,_currentProcess.process.lcsx=t.rows[0].lcsx,_currentProcess.process.sfzlc=t.rows[0].sfzlc,_currentProcess.process.flcjddyid=t.rows[0].flcjddyid,_currentProcess.process.flcjdslid=t.rows[0].flcjdslid,_currentProcess.process.lcksjddyid=t.rows[0].lcksjddyid,_currentProcess.process.lcksjdslid=t.rows[0].lcksjdslid,_currentProcess.process.lcjsjddyid=t.rows[0].lcjsjddyid,_currentProcess.process.lcjsjdslid=t.rows[0].lcjsjdslid,_currentProcess.process.ywbmc=t.rows[0].ywbmc,_currentProcess.process.ywbzjmc=t.rows[0].ywbzjmc,_currentProcess.process.ywbzjz=t.rows[0].ywbzjz,_currentProcess.process.lcslzt=t.rows[0].lcslzt,_currentProcess.process.qdrid=t.rows[0].qdrid,_currentProcess.process.qdrxm=t.rows[0].qdrxm,_currentProcess.process.qdsj=t.rows[0].qdsj,_currentProcess.process.jsrid=t.rows[0].jsrid,_currentProcess.process.jsrxm=t.rows[0].jsrxm,_currentProcess.process.jssj=t.rows[0].jssj,_currentProcess.process.jsbz=t.rows[0].jsbz),t=null):alert(i.message);i=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}});var n="fk_sl_lc_sys_id=‘"+_sys_id+"’",t="sys_id",i="sys_id^sys_orderid^f_dy_jd_sys_version^f_dy_jd_sys_remark^fk_dy_jd_sys_id^fk_dy_lc_sys_id^fk_sl_lc_sys_id^fk_dy_yy_sys_id^fk_sl_yy_sys_id^jdmc^jdslmc^jdms^jdlx^jdnyh^jdthms^sfszlcjd^sfhyzlc^sfsfzjd^zlcdyid^zlcslid^zb^jdsx^sfbqh^czryid^czrygz^jdzt^kssj^fsqhsj^bthsj^fsthsj^jssj",r="",u="",f='{"whereString":\''+n+"',\"orderByString\":'"+t+"',\"columnsString\":'"+i+"',\"pageSizeString\":'"+r+"',\"pageIndexString\":'"+u+"',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"GetList",data:f,dataType:"json",success:function(n){var u=new Function("","return "+n.d)();if(u.result=="true"){var i=new Function("","return "+u.message)(),r=new HashMap,t=null;$.each(i.rows,function(n){var f,e,o,u;t=null;t=eval("new draw2d.designer_activity(openActivityProperties)");t.generateId(i.rows[n].sys_id);switch(i.rows[n].jdlx){case"0":t.setTitle("开始节点");break;case"1":t.setTitle("过程一般节点");break;case"2":t.setTitle("过程选择节点");break;case"3":t.setTitle("过程聚合节点");break;case"4":t.setTitle("过程聚合选择节点");break;case"5":t.setTitle("结束节点")}t.setContent(i.rows[n].sys_id+"<br/>"+i.rows[n].jdmc);t.setIcon("activity-icon-"+i.rows[n].jdlx);t.setClassName(i.rows[n].jdlx);i.rows[n].zb==""?(o=Math.floor(n/4),u=n%4,f=(u+1)*50+u*150,e=(o+1)*40+o*100+u%2*50):(f=parseInt(i.rows[n].zb.split("_")[0]),e=parseInt(i.rows[n].zb.split("_")[1]));t.sys_orderid=i.rows[n].sys_orderid;t.f_dy_jd_sys_version=i.rows[n].f_dy_jd_sys_version;t.f_dy_jd_sys_remark=i.rows[n].f_dy_jd_sys_remark;t.fk_dy_jd_sys_id=i.rows[n].fk_dy_jd_sys_id;t.fk_dy_lc_sys_id=i.rows[n].fk_dy_lc_sys_id;t.fk_sl_lc_sys_id=i.rows[n].fk_sl_lc_sys_id;t.fk_dy_yy_sys_id=i.rows[n].fk_dy_yy_sys_id;t.fk_sl_yy_sys_id=i.rows[n].fk_sl_yy_sys_id;t.jdmc=i.rows[n].jdmc;t.jdslmc=i.rows[n].jdslmc;t.jdms=i.rows[n].jdms;t.jdlx=i.rows[n].jdlx;t.jdnyh=i.rows[n].jdnyh;t.jdthms=i.rows[n].jdthms;t.sfszlcjd=i.rows[n].sfszlcjd;t.sfhyzlc=i.rows[n].sfhyzlc;t.sfsfzjd=i.rows[n].sfsfzjd;t.zlcdyid=i.rows[n].zlcdyid;t.zlcslid=i.rows[n].zlcslid;t.zb=i.rows[n].zb;t.jdsx=i.rows[n].jdsx;t.sfbqh=i.rows[n].sfbqh;t.czryid=i.rows[n].czryid;t.czrygz=i.rows[n].czrygz;t.jdzt=i.rows[n].jdzt;t.kssj=i.rows[n].kssj;t.fsqhsj=i.rows[n].fsqhsj;t.bthsj=i.rows[n].bthsj;t.fsthsj=i.rows[n].fsthsj;t.jssj=i.rows[n].jssj;_currentProcess.createActivity(t,f,e);r.put(t.id,t)});i=null;t=null;var f="fk_sl_lc_sys_id=‘"+_sys_id+"’",e='{"whereString":\''+f+"',\"orderByString\":'sys_id',\"columnsString\":'sys_id^sys_version^sys_remark^ljxmc^ljxslmc^ljxlx^ljxzt^fk_dy_lc_sys_id^fk_dy_jd_sys_id_from^fk_dy_jd_sys_id_to^fk_sl_lc_sys_id^fk_sl_jd_sys_id_from^fk_sl_jd_sys_id_to^fk_dy_ljx_sys_id',\"pageSizeString\":'',\"pageIndexString\":'',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"GetList",data:e,dataType:"json",success:function(n){var i=new Function("","return "+n.d)(),t;i.result=="true"?(t=new Function("","return "+i.message)(),$.each(t.rows,function(n){var i=new draw2d.designer_connection,u,f,e;i.id=t.rows[n].sys_id;i.sys_version=t.rows[n].sys_version;i.sys_remark=t.rows[n].sys_remark;i.ljxmc=t.rows[n].ljxmc;i.ljxslmc=t.rows[n].ljxslmc;i.ljxlx=t.rows[n].ljxlx;i.ljxzt=t.rows[n].ljxzt;i.fk_dy_lc_sys_id=t.rows[n].fk_dy_lc_sys_id;i.fk_dy_jd_sys_id_from=t.rows[n].fk_dy_jd_sys_id_from;i.fk_dy_jd_sys_id_to=t.rows[n].fk_dy_jd_sys_id_to;i.fk_sl_lc_sys_id=t.rows[n].fk_sl_lc_sys_id;i.fk_sl_jd_sys_id_from=t.rows[n].fk_sl_jd_sys_id_from;i.fk_sl_jd_sys_id_to=t.rows[n].fk_sl_jd_sys_id_to;i.fk_dy_ljx_sys_id=t.rows[n].fk_dy_ljx_sys_id;u=null;f=null;i.setLineText(i.ljxmc);switch(i.ljxlx){case"0":i.setLineColor(0,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[2];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0];break;case"1":i.setLineColor(0,255,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[2];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0];break;case"2":i.setLineColor(255,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[2];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0];break;case"3":i.setLineColor(255,255,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[3];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[3];break;case"4":i.setLineColor(255,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[1];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[1];break;case"5":i.setLineColor(0,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[0];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0];break;case"6":i.setLineColor(0,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[0];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0];break;case"7":i.setLineColor(0,0,0);u=r.get(i.fk_sl_jd_sys_id_from).ports.data[0];f=r.get(i.fk_sl_jd_sys_id_to).ports.data[0]}e=new draw2d.CommandConnect(_currentProcess,u,f);e.setConnection(i);_currentProcess.getCommandStack().execute(e)}),t=null):alert(i.message);i=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}else alert(u.message);u=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}catch(e){alert(e.message)}}function btn_cancle_designer_onclick(){window.close()}var openType;document.onselectstart=new Function("event.returnValue=false;");var $=jQuery.noConflict(),_isOpenPropertiesPanel=!1,_propertiesPanelObj=null,_currentProcess=null,_currentConnection=null,_currentActivity=null,_designerMain=null,_datetime=new Date,_sys_userid="",_sys_username="",_returnParameter="",_clientInf="",_sys_id="",_theme="",_themeUrl="//162.16.166.1/sara.resource.library/resource/easyui-1.3.4/themes/[theme]/easyui.min.css",_serviceProcessUrl="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/workflow/service/service_t_sl_lc.asmx/",_serviceActivityUrl="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/workflow/service/service_t_sl_jd.asmx/",_serviceConnectionUrl="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/workflow/service/service_t_sl_ljx.asmx/",_serviceWorkItemUrl="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/workflow/service/service_t_workitem.asmx/";$(function(){setTimeout(function(){try{_theme=requestQuery("theme");_sys_id=requestQuery("sys_id");_returnParameter=requestQuery("returnParameter");_sys_userid=requestQuery("sys_userid").returnString();_sys_username=requestQuery("sys_username").returnString();_clientInf='{userid:"'+_sys_userid+'",appcode:"",appname:"",userip:"",usermac:"",username:"'+_sys_username+'"}';_currentProcess=new draw2d.designer_process("designer_process_canvas");_currentProcess.scrollArea=document.getElementById("designer_process_area");_designerMain=$("#body_main");_propertiesPanelObj=_designerMain.layout("panel","east");_propertiesPanelObj.panel({onOpen:function(){_isOpenPropertiesPanel=!0},onClose:function(){_isOpenPropertiesPanel=!1},onLoad:function(){switch(openType){case"process":initProcess();break;case"activity":initActivity();break;case"connection":initConnection()}}});_designerMain.layout("collapse","east");$("#designer_process_tab").tabs({fit:!0,onSelect:function(n){n=="绘图"||n=="编码"&&$("#designer_process_code").val(_currentProcess.toAllJsonString())}});bindData()}catch(n){alert(n.message)}$(window).unload(function(){});var t=$("#body_main").find("link:first");t.attr("href",_themeUrl.replaceAll("[theme]",_theme))},100)});openType="";
