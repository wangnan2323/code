function initActivity(){$("#txt_sys_id").val(_currentActivity.id);$("#txt_jdmc").val(_currentActivity.jdmc);$("#txt_jdms").val(_currentActivity.jdms);$("#txt_jdnyh").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"没有用户"},{value:"1",label:"一个用户"},{value:"2",label:"多个用户[串行]"},{value:"3",label:"多个用户[并行]"},{value:"4",label:"多个用户[竞争]"}],valueField:"value",textField:"label"});$("#txt_jdnyh").combobox("select",_currentActivity.jdnyh);$("#txt_jdthms").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"返回+正常流转"},{value:"1",label:"返回"},{value:"2",label:"正常流转"}],valueField:"value",textField:"label"});$("#txt_jdthms").combobox("select",_currentActivity.jdthms);$("#txt_czrygz").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"用户"},{value:"1",label:"角色"},{value:"2",label:"岗位"},{value:"3",label:"机构"}],valueField:"value",textField:"label"});$("#txt_czrygz").combobox("select",_currentActivity.czrygz);$("#txt_czryid").val(_currentActivity.czryid);$("#txt_fk_dy_yy_sys_id").val(_currentActivity.fk_dy_yy_sys_id);$("#txt_sfszlcjd").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfszlcjd").combobox("select",_currentActivity.sfszlcjd);$("#txt_sfsfzjd").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfsfzjd").combobox("select",_currentActivity.sfsfzjd);$("#txt_sfhyzlc").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfhyzlc").combobox("select",_currentActivity.sfhyzlc);$("#txt_sfbqh").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"是"},{value:"1",label:"否"}],valueField:"value",textField:"label"});$("#txt_sfbqh").combobox("select",_currentActivity.sfbqh);$("#txt_zlcdyid").val(_currentActivity.zlcdyid);$("#txt_jdsx").val(_currentActivity.jdsx);$("#txt_sys_version").val(_currentActivity.sys_version);$("#txt_sys_remark").val(_currentActivity.sys_remark);$("#txt_jdlx").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"开始节点；[无入口，有出口]"},{value:"1",label:"过程一般节点；[一入口，一出口]"},{value:"2",label:"过程选择节点；[一入口，多出口]"},{value:"3",label:"过程聚合节点；[多入口，一出口]"},{value:"4",label:"过程聚合选择节点；[多入口，多出口]"},{value:"5",label:"结束节点；[有入口，无出口]"}],valueField:"value",textField:"label"});$("#txt_jdlx").combobox("select",_currentActivity.header.className.split("-")[2]);$("#txt_jdlx").combobox("disable");$("#txt_fk_dy_lc_sys_id").val(_currentProcess.process.id);$("#txt_zb").val(_currentActivity.x+"_"+_currentActivity.y+"_"+_currentActivity.width+"_"+_currentActivity.height);var n="sys_id=‘"+_currentActivity.id+"’",t='{"whereString":\''+n+"',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"GetCount",data:t,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?t.message=="0"?($("#txt_sys_id").removeAttr("disabled"),isActivityContainsInDataBase=!1):($("#txt_sys_id").attr("disabled","disabled"),isActivityContainsInDataBase=!0):alert(t.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_save_activity(){var t,n;if(_currentActivity.id=$("#txt_sys_id").val(),_currentActivity.jdmc=$("#txt_jdmc").val(),_currentActivity.jdms=$("#txt_jdms").val(),_currentActivity.jdlx=$("#txt_jdlx").combo("getValue"),_currentActivity.jdnyh=$("#txt_jdnyh").combo("getValue"),_currentActivity.jdthms=$("#txt_jdthms").combo("getValue"),_currentActivity.czryid=$("#txt_czryid").val(),_currentActivity.czrygz=$("#txt_czrygz").combo("getValue"),_currentActivity.fk_dy_yy_sys_id=$("#txt_fk_dy_yy_sys_id").val(),_currentActivity.sfszlcjd=$("#txt_sfszlcjd").combo("getValue"),_currentActivity.sfhyzlc=$("#txt_sfhyzlc").combo("getValue"),_currentActivity.zlcdyid=$("#txt_zlcdyid").val(),_currentActivity.jdsx=$("#txt_jdsx").val(),_currentActivity.sfbqh=$("#txt_sfbqh").combo("getValue"),_currentActivity.sys_version=$("#txt_sys_version").val(),_currentActivity.sys_remark=$("#txt_sys_remark").val(),_currentActivity.sfsfzjd=$("#txt_sfsfzjd").combo("getValue"),_currentActivity.setContent(_currentActivity.id+"<br/>"+_currentActivity.jdmc),_currentActivity.id.indexOf("activity_")>-1)showMessage("数据入库失败！<br/>请修改sys_id为正确的格式。","warning","window");else if(isActivityContainsInDataBase==!0){var i=_currentActivity.toJsonString(),n='{"columns":\'sys_id^sys_version^sys_remark^jdmc^jdms^jdlx^jdnyh^jdthms^sfszlcjd^sfhyzlc^sfsfzjd^zlcdyid^zb^jdsx^sfbqh^czryid^czrygz^fk_dy_yy_sys_id^fk_dy_lc_sys_id^sys_lastedituserid^sys_lasteditusername^sys_lasteditdatetime\',"clientInf":\''+_clientInf+"',\"json\":'"+i+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"Update",data:n,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?showMessage("保存成功。","result","window"):showMessage("保存失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window")},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}else t=_currentActivity.toJsonString(),n='{"json":\''+t+"',\"clientInf\":'"+_clientInf+"'}",$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"Add",data:n,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?(showMessage("新建成功。","result","window"),$("#txt_sys_id").attr("disabled","disabled"),isActivityContainsInDataBase=!0):alert(t.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_delete_activity(){$.messager.confirm("警告","确定删除？",function(n){if(n){var t="fk_dy_jd_sys_id_from in ('"+_currentActivity.id+"') or fk_dy_jd_sys_id_to in ('"+_currentActivity.id+"')",i='{"clientInf":\''+_clientInf+"',\"whereString\":'"+t.formatString()+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"Delete",data:i,dataType:"json",success:function(n){var t=new Function("","return "+n.d)(),i,r;t.result=="true"?(i="sys_id in ('"+_currentActivity.id+"')",r='{"clientInf":\''+_clientInf+"',\"whereString\":'"+i.formatString()+"'}",$.ajax({type:"post",contentType:"application/json",url:_serviceActivityUrl+"Delete",data:r,dataType:"json",success:function(n){var t=new Function("","return "+n.d)(),i;t.result=="true"?(i=_currentActivity.getWorkflow(),i.getCommandStack().execute(new draw2d.CommandDelete(_currentActivity)),showMessage("删除成功。","result","window"),_designerMain.layout("collapse","east"),_isOpenPropertiesPanel=!1,_propertiesPanelObj.panel("refresh","workflowdefinition_none.html")):showMessage("删除失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window");t=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})):showMessage("删除失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window");t=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}})}var isActivityContainsInDataBase=!1;
