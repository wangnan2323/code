function initConnection(){$("#txt_sys_id").val(_currentConnection.id);$("#txt_ljxmc").val(_currentConnection.ljxmc);$("#txt_ljxlx").combobox({multiple:!1,editable:!1,data:[{value:"0",label:"后继"},{value:"1",label:"流程启动连接线"},{value:"2",label:"流程结束连接线"},{value:"3",label:"退回"},{value:"4",label:"驳回"},{value:"5",label:"启动子流程"},{value:"6",label:"子流程结束连接线"},{value:"7",label:"远程连接线"}],valueField:"value",textField:"label"});$("#txt_ljxlx").combobox("select",_currentConnection.ljxlx);$("#txt_sys_version").val(_currentConnection.sys_version);$("#txt_sys_remark").val(_currentConnection.sys_remark);$("#txt_fk_dy_lc_sys_id").val(_currentProcess.process.id);$("#txt_fk_dy_jd_sys_id_from").val(_currentConnection.sourcePort.parentNode.id);$("#txt_fk_dy_jd_sys_id_to").val(_currentConnection.targetPort.parentNode.id);var n="sys_id=‘"+_currentConnection.id+"’",t='{"whereString":\''+n+"',\"clientInf\":'"+_clientInf+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"GetCount",data:t,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?t.message=="0"?($("#txt_sys_id").removeAttr("disabled"),isConnectionContainsInDataBase=!1):($("#txt_sys_id").attr("disabled","disabled"),isConnectionContainsInDataBase=!0):alert(t.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_save_connection(){var t,n;_currentConnection.id=$("#txt_sys_id").val();_currentConnection.ljxmc=$("#txt_ljxmc").val();_currentConnection.ljxlx=$("#txt_ljxlx").combo("getValue");_currentConnection.sys_version=$("#txt_sys_version").val();_currentConnection.sys_remark=$("#txt_sys_remark").val();_currentConnection.setLineText(_currentConnection.ljxmc);switch(_currentConnection.ljxlx){case"0":_currentConnection.setLineColor(0,0,0);break;case"1":_currentConnection.setLineColor(0,255,0);break;case"2":_currentConnection.setLineColor(255,0,0);break;case"3":_currentConnection.setLineColor(255,255,0);break;case"4":_currentConnection.setLineColor(255,0,0);break;case"5":_currentConnection.setLineColor(0,0,0);break;case"6":_currentConnection.setLineColor(0,0,0);break;case"7":_currentConnection.setLineColor(0,0,0)}if(_currentConnection.id.indexOf("connection_")>-1)showMessage("数据入库失败！<br/>请修改sys_id为正确的格式。","warning","window");else if(isConnectionContainsInDataBase==!0){var i=_currentConnection.toJsonString(),n='{"columns":\'sys_id^sys_version^sys_remark^fk_dy_lc_sys_id^fk_dy_jd_sys_id_from^fk_dy_jd_sys_id_to^ljxlx^ljxmc^sys_lastedituserid^sys_lasteditusername^sys_lasteditdatetime\',"clientInf":\''+_clientInf+"',\"json\":'"+i+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"Update",data:n,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?showMessage("保存成功。","result","window"):showMessage("保存失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window")},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}else t=_currentConnection.toJsonString(),n='{"json":\''+t+"',\"clientInf\":'"+_clientInf+"'}",$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"Add",data:n,dataType:"json",success:function(n){var t=new Function("","return "+n.d)();t.result=="true"?(showMessage("新建成功。","result","window"),$("#txt_sys_id").attr("disabled","disabled"),isConnectionContainsInDataBase=!0):alert(t.message)},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}function btn_delete_connection(){$.messager.confirm("警告","确定删除？",function(n){if(n){var t="sys_id in ('"+_currentConnection.id+"')",i='{"clientInf":\''+_clientInf+"',\"whereString\":'"+t.formatString()+"'}";$.ajax({type:"post",contentType:"application/json",url:_serviceConnectionUrl+"Delete",data:i,dataType:"json",success:function(n){var t=new Function("","return "+n.d)(),i;t.result=="true"?(i=_currentConnection.getWorkflow(),i.getCommandStack().execute(new draw2d.CommandDelete(_currentConnection)),showMessage("删除成功。","result","window"),_designerMain.layout("collapse","east"),_isOpenPropertiesPanel=!1,_propertiesPanelObj.panel("refresh","workflowdefinition_none.html")):showMessage("删除失败。<br/>以下信息可能有助于解决此问题：<br/>"+t.message+"","error","window");t=null},error:function(n){alert(n.responseText)},complete:function(n){clearXmlHttpRequest(n)}})}})}var isConnectionContainsInDataBase=!1;
