var _clientInf="",_pr_appcode="",_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,_pr_appnameid="",_pr_appname="",t_field_tree_Obj=function(){"use strict";var t=function(n){n!==null&&(n||(n=window.event),n.preventDefault?(n.preventDefault(),n.stopPropagation()):(n.returnValue=!1,n.cancelBubble=!0))},n={_serviceUrl:"//127.0.0.1/sara.dd.ldsw/sara.platform.operation/auth/service/service_t_field.asmx/",_baseCodeHashMap:null,_ladda_btn_command_newXX:null,_pr_pagetype:"",_lastScrollTop:0,init:function(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");initAffixMenu();basePageObj.initBasePage({success:function(){n.initParameter({success:function(){n.bindData("",{success:function(){n._ladda_btn_command_newXX=Ladda.create("btn_command_newXX_t_field_list");_blockMessage.hidden()}})}})}})}catch(t){_blockMessage.show("程序初始化失败。<br/>"+t.message,"fail")}},initParameter:function(t){try{n._pr_pagetype=requestQuery("pagetype");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'"}';t.success()}catch(i){_blockMessage.show("initParameter_t_field_tree执行失败"+i.message,"fail")}},bindData:function(t,i){try{var r={},r={whereString:"",orderByString:"f_nodeid asc",columnsString:"",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",r,{success:function(r){var o=new Function("","return "+r)(),e=o.rows,u="",f=$.grep(e,function(n){return n.f_parentid=="0"});$.each(f,function(n){n==0?(u+='<li class="parent_li">',u+='<span f_id="'+f[n].f_id+'" f_name="'+f[n].f_name+'" f_nodeid="'+f[n].f_nodeid+'"><i class="icon-plus-sign hand" onclick="t_field_tree_Obj.nodeFoldClick(event,this);"><a>'+f[n].f_name+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+="<\/ul>",u+="<\/li>"):(u+='<li class="parent_li">',u+='<span f_id="'+f[n].f_id+'" f_name="'+f[n].f_name+'" f_nodeid="'+f[n].f_nodeid+'"><i class="icon-plus-sign hand" onclick="t_field_tree_Obj.nodeFoldClick(event,this);"><a>'+f[n].f_name+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+="<\/ul>",u+="<\/li>")});n._lastScrollTop=$("#ul_treeroot").parent().scrollTop();$("#ul_treeroot").html(u);e.length>0&&t==""?($("#div_content").load("../t_field/t_field_detail_part.html",null,function(){n.selectNode(null,null,e[0].f_id)}),n.nodeFoldClick(null,$('*[f_id="'+e[0].f_id+'"]')[0].children[0])):n.nodeFoldClick(null,$('*[f_id="'+t+'"]')[0].children[0]);i.success()},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}catch(u){_blockMessage.show("bindData_t_field_tree执行失败。<br/>"+u.message,"fail")}},renderTreeNodeHtml:function(t,i){var r="",u=$.grep(t,function(n){return n.f_parentid==i});return $.each(u,function(i){var f=n.renderTreeNodeHtml(t,u[i].f_id);f==""?(r+="<li>",r+='<span f_id="'+u[i].f_id+'" f_name="'+u[i].f_name+'" f_nodeid="'+u[i].f_nodeid+'"><i class="icon-leaf">'+u[i].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<\/li>"):(r+='<li class="parent_li">',r+='<span f_id="'+u[i].f_id+'" f_name="'+u[i].f_name+'" f_nodeid="'+u[i].f_nodeid+'"><i class="icon-minus-sign hand" onclick="t_field_tree_Obj.nodeFoldClick(event,this);" >'+u[i].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<ul>",r+=f,r+="<\/ul>",r+="<\/li>")}),r},nodeFoldClick:function(i,r){var u;if(r=$(r).is("A")?$(r.parentNode.parentNode):$(r.parentNode),u=r.parent("li.parent_li").find(" > ul > li"),u.length==0||i==null){var f={whereString:" f_parentid !='0'",orderByString:"f_nodeid asc",columnsString:"f_id,f_name,f_parentid,f_nodeid",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",f,{success:function(t){var f=new Function("","return "+t)(),i=$.grep(f.rows,function(n){return n.f_nodeid.substring(0,4)==r.attr("f_nodeid")}),u="";$.each(i,function(t,r){if(r.f_nodeid.length>8)return!0;var f=n.renderTreeNodeHtml(i,r.f_id);f==""?(u+="<li>",u+='<span f_id="'+i[t].f_id+'" f_name="'+i[t].f_name+'" f_nodeid="'+i[t].f_nodeid+'"><i class="icon-leaf">'+i[t].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<\/li>"):(u+='<li class="parent_li">',u+='<span f_id="'+i[t].f_id+'" f_name="'+i[t].f_name+'" f_nodeid="'+i[t].f_nodeid+'"><i class="icon-minus-sign hand" onclick="t_field_tree_Obj.nodeFoldClick(event,this);" >'+i[t].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_field_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+=f,u+="<\/ul>",u+="<\/li>")});r.parent("li.parent_li").find(" > ul").html(u);r.find(" > i").hasClass("icon-plus-sign")?r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"):r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}else u.is(":visible")?(u.hide("fast"),r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")):(u.show("fast"),r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"));t(i)},nodeEditClick:function(t,i){i=$(i).is("A")?$(i.parentNode.parentNode):$(i.parentNode);n.selectNode(null,null,i.attr("f_id"))},selectNode:function(i,r,u){$("#div_content").load("../t_field/t_field_detail_part.html",null,function(){t_field_detail_Obj._pr_f_id=u;t_field_detail_Obj._pr_pagetype=n._pr_pagetype;t_field_detail_Obj.init({success:function(){$("#div_content").css("display","");$("#div_loading_content").css("display","none");$(".bg-warning").removeClass("bg-warning");$('.tree [f_id="'+u+'"]:first').addClass("bg-warning");n._lastScrollTop!=0&&($("#ul_treeroot").parent().scrollTop(n._lastScrollTop),n._lastScrollTop=0)}})});t(i)},getNodeID:function(t){var i={nodeid:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetNodeID",i,{success:function(n){var r=new Function("","return "+n)(),i=JSON.stringify(r);switch(i.length){case 1:i="000"+i;break;case 2:i="00"+i;break;case 3:i="0"+i;break;case 4:i}t.success(i)},fail:function(t){_blockMessage.show(n._serviceUrl+"GetNodeID<br/>"+t,"fail")}})},btn_command_newXX_onclick:function(){try{n._ladda_btn_command_newXX.start();n.getNodeID({success:function(t){var i=new Date,r={f_value1:"",f_value2:"",f_value3:"",f_value4:"",f_value5:"",f_value6:"",f_value7:"",f_value8:"",f_value9:"",f_value10:"",f_id:"0",f_name:"新建选项"+i.Format("yyyyMMddhhmmss"),f_parentid:"0",f_parentname:"",f_nodeid:t,f_type:"root",f_registdate:i.Format("yyyy-MM-dd hh:mm:ss"),f_inputer:basePageObj._userInfoJson.sys_userid,f_state:"1",sys_appcode:_pr_appcode},u={clientInf:_clientInf,json:JSON.stringify(r)};doAjaxFunction(n._serviceUrl,"Add",u,{success:function(t){n.bindData(t,{success:function(){n._ladda_btn_command_newXX.stop();n.selectNode(null,null,t)}})},fail:function(t){n._ladda_btn_command_newXX.stop();_blockMessage.show(n._serviceUrl+"Add<br/>"+t,"fail")},error:function(t){n._ladda_btn_command_newXX.stop();_blockMessage.show(n._serviceUrl+"Add<br/>"+t,"fail")}})}})}catch(t){n._ladda_btn_command_newXX.stop();_blockMessage.show("新建程序异常。"+t.message,"fail")}}};return n}();$(document).ready(t_field_tree_Obj.init);
