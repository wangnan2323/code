var _clientInf='{userid:"",appcode:"",appname:"",userip:"",usermac:"",username:""}',_pr_appcode="",_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,_pr_appnameid="",_pr_appname="",t_rule_tree_Obj=function(){"use strict";var t=function(n){n!==null&&(n||(n=window.event),n.preventDefault?(n.preventDefault(),n.stopPropagation()):(n.returnValue=!1,n.cancelBubble=!0))},n={_serviceUrl:"//127.0.0.1/sara.dd.ldsw/sara.platform.operation/auth/service/service_t_rule.asmx/",_baseCodeHashMap:null,_ladda_btn_command_newQX:null,_pr_pagetype:"",_lastScrollTop:0,init:function(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");initAffixMenu();basePageObj.initBasePage({success:function(){n.initParameter({success:function(){n.bindData("",{success:function(){n._ladda_btn_command_newQX=Ladda.create("btn_command_newQX_t_rule_list");_blockMessage.hidden()}})}})}})}catch(t){_blockMessage.show("程序初始化失败。<br/>"+t.message,"fail")}},initParameter:function(t){try{_pr_appcode="";n._pr_pagetype=requestQuery("pagetype");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'"}';t.success()}catch(i){_blockMessage.show("initParameter_t_rule_tree执行失败"+i.message,"fail")}},bindData:function(t,i){try{var r={},r={whereString:" length(f_code)=4",orderByString:"f_code asc",columnsString:"",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",r,{success:function(r){var e=new Function("","return "+r)(),u=e.rows,f="";$.each(u,function(n){n==0?(f+='<li class="parent_li">',f+='<span f_id="'+u[n].f_id+'" f_name="'+u[n].f_name+'" f_code="'+u[n].f_code+'"><i class="icon-plus-sign hand" onclick="t_rule_tree_Obj.nodeFoldClick(event,this);"><a>'+u[n].f_name+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',f+="<ul>",f+="<\/ul>",f+="<\/li>"):(f+='<li class="parent_li">',f+='<span f_id="'+u[n].f_id+'" f_name="'+u[n].f_name+'" f_code="'+u[n].f_code+'"><i class="icon-plus-sign hand" onclick="t_rule_tree_Obj.nodeFoldClick(event,this);"><a>'+u[n].f_name+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',f+="<ul>",f+="<\/ul>",f+="<\/li>")});n._lastScrollTop=$("#ul_treeroot").parent().scrollTop();$("#ul_treeroot").html(f);u.length>0&&t==""?($("#div_content").load("../t_rule/t_rule_detail_part.html",null,function(){n.selectNode(null,null,u[0].f_id)}),n.nodeFoldClick(null,$('*[f_id="'+u[0].f_id+'"]')[0].children[0])):n.nodeFoldClick(null,$('*[f_id="'+t+'"]')[0].children[0]);i.success()},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}catch(u){_blockMessage.show("bindData_t_rule_tree执行失败。<br/>"+u.message,"fail")}},renderTreeNodeHtml:function(t,i){var r="",u=$.grep(t,function(n){return n.f_code.indexOf(i)==0&&n.f_code.length==Number(i.length)+4});return $.each(u,function(i){var f=n.renderTreeNodeHtml(t,u[i].f_code);f==""?(r+="<li>",r+='<span f_id="'+u[i].f_id+'" f_name="'+u[i].f_name+'" f_code="'+u[i].f_code+'"><i class="icon-leaf">'+u[i].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<\/li>"):(r+='<li class="parent_li">',r+='<span f_id="'+u[i].f_id+'" f_name="'+u[i].f_name+'" f_code="'+u[i].f_code+'"><i class="icon-minus-sign hand" onclick="t_rule_tree_Obj.nodeFoldClick(event,this);" >'+u[i].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<ul>",r+=f,r+="<\/ul>",r+="<\/li>")}),r},nodeFoldClick:function(i,r){var u;if(r=$(r).is("A")?$(r.parentNode.parentNode):$(r.parentNode),u=r.parent("li.parent_li").find(" > ul > li"),u.length==0||i==null){var f=" f_code like '"+r.attr("f_code")+"%' and length(f_code)>'"+r.attr("f_code").length+"' ",e={whereString:f,orderByString:"f_code asc",columnsString:"f_id,f_name,f_code",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",e,{success:function(t){var f=new Function("","return "+t)(),i=$.grep(f.rows,function(n){return n.f_code.length==Number(r.attr("f_code").length)+4}),u="";$.each(i,function(t){var r=n.renderTreeNodeHtml(f.rows,i[t].f_code);r==""?(u+="<li>",u+='<span f_id="'+i[t].f_id+'" f_name="'+i[t].f_name+'" f_code="'+i[t].f_code+'"><i class="icon-leaf">'+i[t].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<\/li>"):(u+='<li class="parent_li">',u+='<span f_id="'+i[t].f_id+'" f_name="'+i[t].f_name+'" f_code="'+i[t].f_code+'"><i class="icon-minus-sign hand" onclick="t_rule_tree_Obj.nodeFoldClick(event,this);" >'+i[t].f_name+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_rule_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+=r,u+="<\/ul>",u+="<\/li>")});r.parent("li.parent_li").find(" > ul").html(u);r.find(" > i").hasClass("icon-plus-sign")?r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"):r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}else u.is(":visible")?(u.hide("fast"),r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")):(u.show("fast"),r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"));t(i)},nodeEditClick:function(t,i){i=$(i).is("A")?$(i.parentNode.parentNode):$(i.parentNode);n.selectNode(null,null,i.attr("f_id"))},selectNode:function(i,r,u){$("#div_content").load("../t_rule/t_rule_detail_part.html",null,function(){t_rule_detail_Obj._pr_f_id=u;t_rule_detail_Obj._pr_pagetype=n._pr_pagetype;t_rule_detail_Obj.init({success:function(){$("#div_content").css("display","");$("#div_loading_content").css("display","none");$(".bg-warning").removeClass("bg-warning");$('.tree [f_id="'+u+'"]:first').addClass("bg-warning");n._lastScrollTop!=0&&($("#ul_treeroot").parent().scrollTop(n._lastScrollTop),n._lastScrollTop=0)}})});t(i)},getNewCode:function(t){var i={f_code:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetNewCode",i,{success:function(n){var r=new Function("","return "+n)(),i=JSON.stringify(r);switch(i.length){case 1:i="000"+i;break;case 2:i="00"+i;break;case 3:i="0"+i;break;case 4:i}t.success(i)},fail:function(t){_blockMessage.show(n._serviceUrl+"GetNewCode<br/>"+t,"fail")}})},btn_command_newQX_onclick:function(){try{n._ladda_btn_command_newQX.start();n.getNewCode({success:function(t){var i=new Date,r={f_value1:"",f_value2:"",f_value3:"",f_value4:"",f_value5:"",f_value6:"",f_value7:"",f_value8:"",f_value9:"",f_value10:"",f_id:"0",f_code:t,f_parentcode:0,f_name:"新建权限"+i.Format("yyyyMMddhhmmss"),f_url:"",f_target:"",f_tile:"",f_sys_appcode:"",f_registdate:i.Format("yyyy-MM-dd hh:mm:ss"),f_inputer:basePageObj._userInfoJson.sys_userid,f_state:"1",f_rulemodel:"1"},u={clientInf:_clientInf,json:JSON.stringify(r)};doAjaxFunction(n._serviceUrl,"Add",u,{success:function(t){n.bindData(t,{success:function(){n._ladda_btn_command_newQX.stop();n.selectNode(null,null,t)}})},fail:function(t){n._ladda_btn_command_newQX.stop();_blockMessage.show(n._serviceUrl+"Add<br/>"+t,"fail")},error:function(t){n._ladda_btn_command_newQX.stop();_blockMessage.show(n._serviceUrl+"Add<br/>"+t,"fail")}})}})}catch(t){n._ladda_btn_command_newQX.stop();_blockMessage.show("新建程序异常。","fail")}}};return n}();$(document).ready(t_rule_tree_Obj.init);
