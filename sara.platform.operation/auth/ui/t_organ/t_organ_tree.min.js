var _clientInf='{userid:"",appcode:"",appname:"",userip:"",usermac:"",username:""}',_pr_appcode="",_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,_pr_appnameid="",_pr_appname="",t_organ_tree_Obj=function(){"use strict";var i=function(n){n!==null&&(n||(n=window.event),n.preventDefault?(n.preventDefault(),n.stopPropagation()):(n.returnValue=!1,n.cancelBubble=!0))},t="",n={_serviceUrl:"//127.0.0.1/sara.dd.ldsw/sara.platform.operation/auth/service/service_t_organ.asmx/",_baseCodeHashMap:null,_ladda_btn_command_save:null,_pr_pagetype:"",init:function(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");initAffixMenu();basePageObj.initBasePage({success:function(){n.initParameter({success:function(){n.bindData({success:function(){_blockMessage.hidden()}})}})}})}catch(t){_blockMessage.show("程序初始化失败。<br/>"+t.message,"fail")}},initParameter:function(i){try{_pr_appcode="";n._pr_pagetype=requestQuery("pagetype");t=requestQuery("bmgly_organid");t=t=="1"?basePageObj._userInfoJson.sys_organid+"+":t=="2"?basePageObj._userInfoJson.sys_organid:"";_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'"}';i.success()}catch(r){_blockMessage.show("initParameter_t_organ_tree执行失败"+r.message,"fail")}},bindData:function(i){var u;try{var r=" length(o_nodeid)=4";t&&(r="");u={organid:t||"",whereString:r,orderByString:"o_nodeid",columnsString:"",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",u,{success:function(t){var f=new Function("","return "+t)(),r=f.rows,u="";$.each(r,function(n){n==0?(u+='<li class="parent_li">',u+='<span o_id="'+r[n].o_id+'" o_fullname="'+r[n].o_fullname+'" o_nodeid="'+r[n].o_nodeid+'"><i class="icon-plus-sign hand" onclick="t_organ_tree_Obj.nodeFoldClick(event,this);"><a>'+r[n].o_fullname+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+="<\/ul>",u+="<\/li>"):(u+='<li class="parent_li">',u+='<span o_id="'+r[n].o_id+'" o_fullname="'+r[n].o_fullname+'" o_nodeid="'+r[n].o_nodeid+'"><i class="icon-plus-sign hand" onclick="t_organ_tree_Obj.nodeFoldClick(event,this);"><a>'+r[n].o_fullname+'<\/a><\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+="<\/ul>",u+="<\/li>")});$("#ul_treeroot").html(u);r.length>0&&($("#div_content").load("../t_organ/t_organ_detail_part.html",null,function(){n.selectNode(null,null,r[0].o_id,r[0].o_fullname)}),t_organ_tree_Obj.nodeFoldClick(null,$('*[o_id="'+r[0].o_id+'"]')[0].children[0]));i.success()},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}catch(f){_blockMessage.show("bindData_t_organ_tree执行失败。<br/>"+f.message,"fail")}},renderTreeNodeHtml:function(t,i){var r="",u=$.grep(t,function(n){return n.o_nodeid.indexOf(i)==0&&n.o_nodeid.length==Number(i.length)+4});return $.each(u,function(i){var f=n.renderTreeNodeHtml(t,u[i].o_nodeid);f==""?(r+="<li>",r+='<span o_id="'+u[i].o_id+'" o_fullname="'+u[i].o_fullname+'" o_nodeid="'+u[i].o_nodeid+'"><i class="icon-leaf">'+u[i].o_fullname+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<\/li>"):(r+='<li class="parent_li">',r+='<span o_id="'+u[i].o_id+'" o_fullname="'+u[i].o_fullname+'" o_nodeid="'+u[i].o_nodeid+'"><i class="icon-minus-sign hand" onclick="t_organ_tree_Obj.nodeFoldClick(event,this);" >'+u[i].o_fullname+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',r+="<ul>",r+=f,r+="<\/ul>",r+="<\/li>")}),r},nodeFoldClick:function(t,r){var u;if(r=$(r).is("A")?$(r.parentNode.parentNode):$(r.parentNode),u=r.parent("li.parent_li").find(" > ul > li"),u.length==0||t==null){var f=" o_nodeid like '"+r.attr("o_nodeid")+"%' and length(o_nodeid)>'"+r.attr("o_nodeid").length+"' ",e={organid:"",whereString:f,orderByString:"o_nodeid",columnsString:"o_id,o_fullname,o_nodeid",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(n._serviceUrl,"GetList",e,{success:function(t){var f=new Function("","return "+t)(),i=$.grep(f.rows,function(n){return n.o_nodeid.length==Number(r.attr("o_nodeid").length)+4}),u="";$.each(i,function(t){var r=n.renderTreeNodeHtml(f.rows,i[t].o_nodeid);r==""?(u+="<li>",u+='<span o_id="'+i[t].o_id+'" o_fullname="'+i[t].o_fullname+'" o_nodeid="'+i[t].o_nodeid+'"><i class="icon-leaf">'+i[t].o_fullname+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<\/li>"):(u+='<li class="parent_li">',u+='<span o_id="'+i[t].o_id+'" o_fullname="'+i[t].o_fullname+'" o_nodeid="'+i[t].o_nodeid+'"><i class="icon-minus-sign hand" onclick="t_organ_tree_Obj.nodeFoldClick(event,this);" >'+i[t].o_fullname+'<\/i><i class="glyphicon glyphicon-edit left20 hand" onclick="t_organ_tree_Obj.nodeEditClick(event,this);"><\/i><\/span>',u+="<ul>",u+=r,u+="<\/ul>",u+="<\/li>")});r.parent("li.parent_li").find(" > ul").html(u);r.find(" > i").hasClass("icon-plus-sign")?r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"):r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")},fail:function(t){_blockMessage.show(n._serviceUrl+"GetList<br/>"+t,"fail")}})}else u.is(":visible")?(u.hide("fast"),r.find(" > i.icon-minus-sign").addClass("icon-plus-sign").removeClass("icon-minus-sign")):(u.show("fast"),r.find(" > i.icon-plus-sign").addClass("icon-minus-sign").removeClass("icon-plus-sign"));i(t)},nodeEditClick:function(t,i){i=$(i).is("A")?$(i.parentNode.parentNode):$(i.parentNode);n.selectNode(null,null,i.attr("o_id"),i.attr("o_fullname"))},selectNode:function(t,r,u){$("#div_content").load("../t_organ/t_organ_detail_part.html",null,function(){t_organ_detail_Obj._pr_sys_id=u;t_organ_detail_Obj._pr_pagetype=n._pr_pagetype;t_organ_detail_Obj.init({success:function(){$("#div_content").css("display","");$("#div_loading_content").css("display","none");$(".bg-warning").removeClass("bg-warning");$('.tree [o_id="'+u+'"]:first').addClass("bg-warning")}})});i(t)}};return n}();$(document).ready(t_organ_tree_Obj.init);
