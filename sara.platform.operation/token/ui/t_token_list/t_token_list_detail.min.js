var _pr_fromurl="",_pr_fromurlparam="",_pr_appcode="",_clientInf='{userid:"",appcode:"",appname:"",userip:"",usermac:"",username:"",userimg:""}',_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,t_token_list_detail_Obj=function(){"use strict";var s="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/token/service/service_t_token_list.asmx/",h="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/token/service/service_t_token_function.asmx/",l="//127.0.0.1/sara.dd.ldsw/sara.platform.operation/token/service/service_t_token_relation.asmx/",a=null,e=null,o=null,v="",y=1,n="",p=5,u=1,t="",c="",k=[{id:"true",text:"true"},{id:"false",text:"false"}],d=function(n){try{_pr_fromurl=requestQuery("fromurl");_pr_fromurlparam=requestQuery("fromurlparam");i._pr_sys_id=requestQuery("sys_id");i._pr_pagetype=requestQuery("pagetype");_pr_appcode=requestQuery("appcode");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'",userimg:"'+basePageObj._userInfoJson.sys_photourl+'"}';i._pr_sys_id==null||i._pr_sys_id==""?_blockMessage.show("_pr_sys_id参数接收失败","fail"):i._pr_pagetype==null||i._pr_pagetype==""?_blockMessage.show("_pr_pagetype参数接收失败...","fail"):n.success()}catch(t){_blockMessage.show("initParameter执行失败"+t.message,"fail")}},g=function(n){n.success()},nt=function(n){try{controlObj.datetimeinit("detail_datetime_f_startdate_t_token_list_detail_date","detail_datetime_f_startdate_t_token_list_detail_time",ot,et);controlObj.datetimeinit("detail_datetime_f_enddate_t_token_list_detail_date","detail_datetime_f_enddate_t_token_list_detail_time",ht,st);controlObj.radiolistinit("detail_txt_f_enable_t_token_list_detail",k);n.success()}catch(t){_blockMessage.show("initControl执行失败。<br/>"+t.message,"fail")}},w=function(n){try{controlObj.textdisable("detail_txt_f_title_t_token_list_detail",n);controlObj.textdisable("detail_txt_f_token_t_token_list_detail",n);controlObj.radiolistdisable("detail_txt_f_enable_t_token_list_detail",n);controlObj.datetimedisable("detail_datetime_f_startdate_t_token_list_detail_date","detail_datetime_f_startdate_t_token_list_detail_time",n);controlObj.datetimedisable("detail_datetime_f_enddate_t_token_list_detail_date","detail_datetime_f_enddate_t_token_list_detail_time",n);controlObj.textdisable("detail_txt_f_bz_t_token_list_detail",n);n?($("#btn_command_save_t_token_list_detail").addClass("hidden"),$(".btn-command-message").attr("disabled","disabled")):($("#btn_command_save_t_token_list_detail").removeClass("hidden"),$(".btn-command-message").removeAttr("disabled"))}catch(t){_blockMessage.show("setDisable执行失败。<br/>"+t.message,"fail")}},tt=function(n,t){controlObj.text("detail_txt_f_value1_t_token_list_detail",n.f_value1);controlObj.text("detail_txt_f_value2_t_token_list_detail",n.f_value2);controlObj.text("detail_txt_f_value3_t_token_list_detail",n.f_value3);controlObj.text("detail_txt_f_value4_t_token_list_detail",n.f_value4);controlObj.text("detail_txt_f_value5_t_token_list_detail",n.f_value5);controlObj.text("detail_txt_f_value6_t_token_list_detail",n.f_value6);controlObj.text("detail_txt_f_value7_t_token_list_detail",n.f_value7);controlObj.text("detail_txt_f_value8_t_token_list_detail",n.f_value8);controlObj.text("detail_txt_f_value9_t_token_list_detail",n.f_value9);controlObj.text("detail_txt_f_value10_t_token_list_detail",n.f_value10);controlObj.text("detail_txt_f_title_t_token_list_detail",n.f_title);controlObj.text("detail_txt_f_token_t_token_list_detail",n.f_token);controlObj.radiolistid("detail_txt_f_enable_t_token_list_detail",n.f_enable);controlObj.datetime("detail_datetime_f_startdate_t_token_list_detail_date","detail_datetime_f_startdate_t_token_list_detail_time",n.f_startdate);controlObj.datetime("detail_datetime_f_enddate_t_token_list_detail_date","detail_datetime_f_enddate_t_token_list_detail_time",n.f_enddate);controlObj.text("detail_txt_f_bz_t_token_list_detail",n.f_bz);t.success()},it=function(n){try{var t={};t.f_value1=controlObj.text("detail_txt_f_value1_t_token_list_detail");t.f_value2=controlObj.text("detail_txt_f_value2_t_token_list_detail");t.f_value3=controlObj.text("detail_txt_f_value3_t_token_list_detail");t.f_value4=controlObj.text("detail_txt_f_value4_t_token_list_detail");t.f_value5=controlObj.text("detail_txt_f_value5_t_token_list_detail");t.f_value6=controlObj.text("detail_txt_f_value6_t_token_list_detail");t.f_value7=controlObj.text("detail_txt_f_value7_t_token_list_detail");t.f_value8=controlObj.text("detail_txt_f_value8_t_token_list_detail");t.f_value9=controlObj.text("detail_txt_f_value9_t_token_list_detail");t.f_value10=controlObj.text("detail_txt_f_value10_t_token_list_detail");t.f_title=controlObj.text("detail_txt_f_title_t_token_list_detail");t.f_token=controlObj.text("detail_txt_f_token_t_token_list_detail");t.f_enable=controlObj.radiolistid("detail_txt_f_enable_t_token_list_detail");t.f_startdate=controlObj.datetime("detail_datetime_f_startdate_t_token_list_detail_date","detail_datetime_f_startdate_t_token_list_detail_time");t.f_enddate=controlObj.datetime("detail_datetime_f_enddate_t_token_list_detail_date","detail_datetime_f_enddate_t_token_list_detail_time");t.f_bz=controlObj.text("detail_txt_f_bz_t_token_list_detail");n.success(t)}catch(i){_blockMessage.show("getData执行失败。<br/>"+i.message,"fail")}},rt=function(n,t){try{var i=new hashMap,r=new hashMap;n.f_value1.length>100&&(i.put("detail_txt_f_value1_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value1_t_token_list_detail","top"));n.f_value2.length>100&&(i.put("detail_txt_f_value2_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value2_t_token_list_detail","top"));n.f_value3.length>100&&(i.put("detail_txt_f_value3_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value3_t_token_list_detail","top"));n.f_value4.length>100&&(i.put("detail_txt_f_value4_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value4_t_token_list_detail","top"));n.f_value5.length>100&&(i.put("detail_txt_f_value5_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value5_t_token_list_detail","top"));n.f_value6.length>100&&(i.put("detail_txt_f_value6_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value6_t_token_list_detail","top"));n.f_value7.length>100&&(i.put("detail_txt_f_value7_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value7_t_token_list_detail","top"));n.f_value8.length>100&&(i.put("detail_txt_f_value8_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value8_t_token_list_detail","top"));n.f_value9.length>100&&(i.put("detail_txt_f_value9_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value9_t_token_list_detail","top"));n.f_value10.length>100&&(i.put("detail_txt_f_value10_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_value10_t_token_list_detail","top"));n.f_title.length>100&&(i.put("detail_txt_f_title_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_title_t_token_list_detail","top"));n.f_token.length>100&&(i.put("detail_txt_f_token_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_token_t_token_list_detail","top"));n.f_enable.length>100&&(i.put("detail_txt_f_enable_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_enable_t_token_list_detail","top"));n.f_bz.length>100&&(i.put("detail_txt_f_bz_t_token_list_detail",'长度不能超过<a style="color:red">100<\/a>'),r.put("detail_txt_f_bz_t_token_list_detail","top"));i.keys().length>0?(a.show(i,r,!0),t.fail()):(a.hidden(),t.success(n))}catch(u){_blockMessage.show("checkData执行失败。<br/>"+u.message,"fail")}},ut=function(n){var t=" sys_id = '"+i._pr_sys_id+"'",r={whereString:t,orderByString:"",columnsString:"f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^f_title^f_token^f_enable^f_startdate^f_enddate^f_bz^sys_id",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(s,"GetList",r,{success:function(t){var i=new Function("","return "+t)();n.success(i.rows[0])},fail:function(n){_blockMessage.show(s+"GetList<br/>"+n,"fail")}})},ft=function(n,t){var r=new Date,u={sys_id:i._pr_sys_id,f_value1:n.f_value1,f_value2:n.f_value2,f_value3:n.f_value3,f_value4:n.f_value4,f_value5:n.f_value5,f_value6:n.f_value6,f_value7:n.f_value7,f_value8:n.f_value8,f_value9:n.f_value9,f_value10:n.f_value10,f_title:n.f_title,f_token:n.f_token,f_enable:n.f_enable,f_startdate:n.f_startdate,f_enddate:n.f_enddate,f_bz:n.f_bz,sys_lasteditusername:basePageObj._userInfoJson.sys_username,sys_lastedituserid:basePageObj._userInfoJson.sys_userid,sys_lasteditdate:r.Format("yyyy-MM-dd hh:mm:ss")},f={columns:"sys_id^f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^f_title^f_token^f_enable^f_startdate^f_enddate^f_bz^sys_lastedituserid^sys_lasteditusername^sys_lasteditdate",clientInf:_clientInf,json:JSON.stringify(u)};doAjaxFunction(s,"Update",f,{success:function(){t.success()},fail:function(n){t.fail(n)},error:function(n){_blockMessage.show(s+"Update<br/>"+n,"fail")}})},et=function(n){var t=_resultMessage.message();t+="<br/>";t+="开始时间"+n.time.value;_resultMessage.message(t)},ot=function(n){var i=new Date(n.date.valueOf()),t=_resultMessage.message();t+="<br/>";t+="开始时间"+i.Format("yyyy-MM-dd");_resultMessage.message(t)},st=function(n){var t=_resultMessage.message();t+="<br/>";t+="结束时间"+n.time.value;_resultMessage.message(t)},ht=function(n){var i=new Date(n.date.valueOf()),t=_resultMessage.message();t+="<br/>";t+="结束时间"+i.Format("yyyy-MM-dd");_resultMessage.message(t)},ct=function(t){$("#table_function_list_t_token_list_detail").bootstrapTable({cache:!1,height:300,striped:!0,pagination:!1,pageSize:v,pageList:[v],pageNumber:y,search:!1,showColumns:!1,showRefresh:!1,clickToSelect:!0,idField:"sys_id",sidePagination:"webserver",columns:[{field:"_checkbox",checkbox:!0,formatter:function(t,r){switch(i._pr_pagetype){case"1":return("^"+n+"^").indexOf("^"+r.sys_id+"^")>-1?{disabled:!1,checked:!0}:t;case"2":return("^"+n+"^").indexOf("^"+r.sys_id+"^")>-1?{disabled:!0,checked:!0}:{disabled:!0}}}},{field:"sys_id",title:"sys_id",align:"center",valign:"middle",visible:!0,sortable:!0},{field:"f_appnameen",title:"系统英文名","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_service",title:"服务","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_function",title:"方法","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}}],onPageChange:function(){},rowStyle:function(){return{}},onLoadSuccess:function(){},onCheck:function(t){n+="^"+t.sys_id;n=n.trimStartEnd("^");f()},onUncheck:function(t){n=("^"+n+"^").replaceAll("^"+t.sys_id+"^","^");n=n.trimStartEnd("^");f()},onCheckAll:function(){var t=$("#table_function_list_t_token_list_detail").bootstrapTable("getSelections");$.each(t,function(i){("^"+n+"^").indexOf("^"+t[i].sys_id+"^")>-1||(n+="^"+t[i].sys_id)});n=n.trimStartEnd("^");f()},onUncheckAll:function(){var t=$("#table_function_list_t_token_list_detail").bootstrapTable("getData");$.each(t,function(i){("^"+n+"^").indexOf("^"+t[i].sys_id+"^")>-1&&(n=("^"+n+"^").replaceAll("^"+t[i].sys_id+"^","^"))});n=n.trimStartEnd("^");f()}});t.success()},f=function(){if(n=="")$("#btn_command_token_clearselect_t_token_list_detail").addClass("hidden");else{$("#btn_command_token_clearselect_t_token_list_detail").removeClass("hidden");var t=n.split("^").length,i=$("#table_function_list_t_token_list_detail").bootstrapTable("getSelections").length;$("#btn_command_token_clearselect_t_token_list_detail .cc-badge-p").html(i+"/"+t)}},lt=function(n){$("#table_relation_list_t_token_list_detail").bootstrapTable({cache:!1,height:250,striped:!0,pagination:!0,pageSize:p,pageList:[p],pageNumber:u,search:!1,showColumns:!1,showRefresh:!1,clickToSelect:!0,idField:"sys_id",sidePagination:"webserver",columns:[{field:"_checkbox",checkbox:!0,formatter:function(n,r){switch(i._pr_pagetype){case"1":return("^"+t+"^").indexOf("^"+r.sys_id+"^")>-1?{disabled:!1,checked:!0}:n;case"2":return("^"+t+"^").indexOf("^"+r.sys_id+"^")>-1?{disabled:!0,checked:!0}:{disabled:!0}}}},{field:"sys_id",title:"sys_id",align:"center",valign:"middle",visible:!0,sortable:!0},{field:"f_appnameen",title:"系统英文名","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_service",title:"服务","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_function",title:"方法","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}}],onPageChange:function(n,t){u=t;i.bindRelationModal()},rowStyle:function(){return{}},onLoadSuccess:function(){},onCheck:function(n){t+="^"+n.sys_id;t=t.trimStartEnd("^");r()},onUncheck:function(n){t=("^"+t+"^").replaceAll("^"+n.sys_id+"^","^");t=t.trimStartEnd("^");r()},onCheckAll:function(){var n=$("#table_relation_list_t_token_list_detail").bootstrapTable("getSelections");$.each(n,function(i){("^"+t+"^").indexOf("^"+n[i].sys_id+"^")>-1||(t+="^"+n[i].sys_id)});t=t.trimStartEnd("^");r()},onUncheckAll:function(){var n=$("#table_relation_list_t_token_list_detail").bootstrapTable("getData");$.each(n,function(i){("^"+t+"^").indexOf("^"+n[i].sys_id+"^")>-1&&(t=("^"+t+"^").replaceAll("^"+n[i].sys_id+"^","^"))});t=t.trimStartEnd("^");r()}});$("#div_new_modal_t_token_list_detail").modal({keyboard:!1,backdrop:"static",show:!1});n.success()},r=function(){if(t=="")$("#btn_command_relation_clearselect_t_token_list_detail").addClass("hidden");else{$("#btn_command_relation_clearselect_t_token_list_detail").removeClass("hidden");var n=t.split("^").length,i=$("#table_relation_list_t_token_list_detail").bootstrapTable("getSelections").length;$("#btn_command_relation_clearselect_t_token_list_detail .cc-badge-p").html(i+"/"+n)}},b=function(){controlObj.text("detail_txt_function_search_t_token_list_detail","");c="";t="";r();$("#table_relation_list_t_token_list_detail").bootstrapTable("loadJson",{total:0,rows:[]});u=1},i={_pr_sys_id:"",_pr_pagetype:"",init:function(){try{_alertMessage=new alertMessage;_confirmMessage=new confirmMessage;_resultMessage=new resultMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");basePageObj.initBasePage({success:function(){d({success:function(){g({success:function(){nt({success:function(){ct({success:function(){i.bindFunctionModal({success:function(){lt({success:function(){i.bindPage({success:function(){a=new validateMessage("btn_command_save_t_token_list_detail");e=Ladda.create("btn_command_save_t_token_list_detail");o=Ladda.create("btn_function_list_delete_t_token_list_detail");switch(i._pr_pagetype){case"1":w(!1);break;case"2":w(!0)}_blockMessage.hidden()}})}})}})}})}})}})}})},fail:function(n){_blockMessage.show(n,"fail")}})}catch(n){_blockMessage.show("程序初始化失败。<br/>"+n.message,"fail")}},bindPage:function(n){try{ut({success:function(t){tt(t,{success:function(){n.success()}})}})}catch(t){_blockMessage.show("bindPage执行失败。<br/>"+t.message,"fail")}},btn_command_save_onclick:function(){try{e.start();it({success:function(n){rt(n,{success:function(n){ft(n,{success:function(){e.stop();_alertMessage.show("保存成功","success",2e3)},fail:function(n){e.stop();_alertMessage.show("保存失败<br/>"+n,"fail")}})},fail:function(){e.stop();_alertMessage.show("校验未通过","warning")}})}})}catch(n){_blockMessage.show("保存程序异常。","fail")}},btn_command_cancle_onclick:function(){var n=_pr_fromurl,t;n+="?uid="+basePageObj._userInfoJson.sys_userid;t=new Function("","return "+_pr_fromurlparam)();$.each(t,function(t,i){n+=typeof i=="object"?"&"+t+"="+JSON.stringify(i):"&"+t+"="+i});commonObj.changeUrl(n,"right-hide")},bindFunctionModal:function(n){setTimeout(function(){var t=i._pr_sys_id,r={isIn:"",sys_id:t,whereString:"",orderByString:"",columnsString:"f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^f_appcode^f_appname^f_appnameen^f_service^f_function^f_istoken^f_isencrypt^f_bz^sys_id",pageSizeString:v,pageIndexString:y,clientInf:_clientInf};doAjaxFunction(h,"GetFunctionListByTokenid",r,{success:function(t){var i=new Function("","return "+t)();$("#table_function_list_t_token_list_detail").bootstrapTable("loadJson",$.extend(i,{pageIndex:y}));f();n!=undefined&&n!=null&&n.success()},fail:function(n){_blockMessage.show(h+"GetList<br/>"+n,"fail")}})},0)},btn_function_list_new_onclick:function(){i.bindRelationModal();$("#div_new_modal_t_token_list_detail").modal("show")},btn_function_list_delete_onclick:function(){var r=n.split("^").length;if(n=="")_alertMessage.show("至少选择一条数据!","warning",5e3);else{o.start();var u=$("#table_function_list_t_token_list_detail").bootstrapTable("getSelections").length,f=r-u,t="<blockquote> ";t+='<h3>将对被选中的全部数据<a style="color:red">'+r+'<\/a>条进行<a style="color:red">删除<\/a><\/h3>';t+="<\/blockquote> ";_confirmMessage.destory();_confirmMessage.show("删除确认？",t,{confirm:function(){var t=n.toString(),r=i._pr_sys_id,u={tokenids:r,functionids:t,deltype:"tt",clientInf:_clientInf};doAjaxFunction(l,"DeleteByTokenidsAndFunctionids",u,{success:function(){n="";i.bindFunctionModal({success:function(){o.stop()}})},fail:function(n){_alertMessage.show("数据删除完成，获取数据条数失败<br/>"+n,"fail");o.stop()}})},cancle:function(){o.stop();_alertMessage.show("操作已取消","success",1e3)}})}},btn_command_function_clearselect_onclick:function(){$("#table_function_list_t_token_list_detail").bootstrapTable("uncheckAll");n="";f()},bindRelationModal:function(n){var t=i._pr_sys_id,f=c,e={isIn:"not",sys_id:t,whereString:f,orderByString:"",columnsString:"f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^f_appcode^f_appname^f_appnameen^f_service^f_function^f_istoken^f_isencrypt^f_bz^sys_id",pageSizeString:p,pageIndexString:u,clientInf:_clientInf};doAjaxFunction(h,"GetFunctionListByTokenid",e,{success:function(t){var i=new Function("","return "+t)();$("#table_relation_list_t_token_list_detail").bootstrapTable("loadJson",$.extend(i,{pageIndex:u}));r();n!=undefined&&n!=null&&n.success()},fail:function(n){_blockMessage.show(h+"GetList<br/>"+n,"fail")}})},btn_detail_modal_ok_onclick:function(){if(t!=""){var n={t_function_list_sys_id:t,t_token_list_sys_id:i._pr_sys_id},r={json:JSON.stringify(n),clientInf:_clientInf};doAjaxFunction(l,"NewList",r,{success:function(){i.bindFunctionModal();b()},fail:function(n){_blockMessage.show(l+"GetList<br/>"+n,"fail")}})}$("#div_new_modal_t_token_list_detail").modal("hide")},btn_detail_modal_cancle_onclick:function(){$("#div_new_modal_t_token_list_detail").modal("hide");b()},btn_command_relation_clearselect_onclick:function(){$("#table_relation_list_t_token_list_detail").bootstrapTable("uncheckAll");t="";r()},btn_function_search_onclick:function(){var n=controlObj.text("detail_txt_function_search_t_token_list_detail").trim();c=n?" f_appcode like '%"+n+"%' or f_appnameen like '%"+n+"%'  or f_service like '%"+n+"%' or f_function like '%"+n+"%' ":"";u=1;i.bindRelationModal()}};return i}();$(document).ready(function(){t_token_list_detail_Obj.init()});
