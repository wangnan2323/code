var _pr_appcode="",_clientInf='{userid="",appcode="54",appname="",userip="",usermac="",username=""}',_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,tbl_app_version_list_Obj=function(){"use strict";var r="//127.0.0.1/sara.dd.ldsw/service/service_tbl_app_version.asmx/",u="10",c=null,f=null,t=null,e="",l=function(t){try{n._pr_listtype=requestQuery("listtype");_pr_appcode=requestQuery("appcode");n._pr_gridselectids=requestQuery("gridselectids");n._pr_gridpageindex=requestQuery("gridpageIndex");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'",userimg:"'+basePageObj._userInfoJson.sys_photourl+'"}';n._pr_gridpageindex=n._pr_gridpageindex==null||n._pr_gridpageindex==""||n._pr_gridpageindex=="null"?1:Number(n._pr_gridpageindex);n._pr_showtype=requestQuery("showtype");n._pr_showtype=n._pr_showtype==null||n._pr_showtype==""||n._pr_showtype=="null"?"false":n._pr_showtype=="false"?"false":"true";controlObj.toggleinit("detail_ck_showtype_tbl_app_version_list",v);controlObj.toggle("detail_ck_showtype_tbl_app_version_list",n._pr_showtype);n._pr_listtype==null||n._pr_listtype==""||n._pr_listtype=="null"?_blockMessage.show("listtype参数接收失败...","fail"):t.success()}catch(i){_blockMessage.show("initParameter执行失败"+i.message,"fail")}},a=function(t){try{var r=0;$(window).width()<basePageObj._limSrceenWidth?(r=$(window).height()-320,r<950&&(r=950)):r=$(window).height()-240;$("#table_grid_tbl_app_version_list").bootstrapTable({cache:!1,height:r,striped:!0,pagination:!0,pageSize:u,pageList:[u],pageNumber:n._pr_gridpageindex,search:!1,showColumns:!1,showRefresh:!1,clickToSelect:!0,idField:"sys_id",sidePagination:"webserver",columns:[{field:"_checkbox",checkbox:!0,formatter:function(t,i){switch(n._pr_listtype){case"1":return("^"+n._pr_gridselectids+"^").indexOf("^"+i.sys_id+"^")>-1?{disabled:!1,checked:!0}:t;case"2":return("^"+n._pr_gridselectids+"^").indexOf("^"+i.sys_id+"^")>-1?{disabled:!0,checked:!0}:{disabled:!0}}}},{field:"sys_id",title:"sys_id",align:"center",valign:"middle",visible:!0,sortable:!0},{field:"f_value1",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value2",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value3",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value4",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value5",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value6",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value7",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value8",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value9",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value10",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_status",title:"启用状态","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_apptype",title:"app类型","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_appstatusid",title:"","class":"hidden",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_appstatus",title:"app状态","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n,t){return t.f_appstatusid=="2"?'<a style="color:red">'+n+"<\/a>":n}},{field:"f_appversion",title:"app版本","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_htmlversion",title:"html版本","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_codeversion",title:"code版本","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_colorversion",title:"color版本","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_comment",title:"说明","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"",title:"操作",align:"center",valign:"middle",sortable:!1,clickToSelect:!1,formatter:function(){switch(n._pr_listtype){case"1":return'<a class="edit ml10" href="javascript:void(0)" title="编辑"><i class="glyphicon glyphicon-edit"><\/i><\/a>';case"2":return'<a class="view ml10" href="javascript:void(0)" title="浏览"><i class="glyphicon glyphicon-eye-open"><\/i><\/a>'}},events:{"click .view":function(n,t,i){o(i.sys_id,"2")},"click .edit":function(n,t,i){o(i.sys_id,"1")}}}],onPageChange:function(t,i){n._pr_gridpageindex=i;n.bindGrid()},rowStyle:function(n){return n.f_status=="true"?{classes:"info"}:{}},onLoadSuccess:function(){},onCheck:function(t){n._pr_gridselectids+="^"+t.sys_id;n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onUncheck:function(t){n._pr_gridselectids=("^"+n._pr_gridselectids+"^").replaceAll("^"+t.sys_id+"^","^");n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onCheckAll:function(){var t=$("#table_grid_tbl_app_version_list").bootstrapTable("getSelections");$.each(t,function(i){("^"+n._pr_gridselectids+"^").indexOf("^"+t[i].sys_id+"^")>-1||(n._pr_gridselectids+="^"+t[i].sys_id)});n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onUncheckAll:function(){var t=$("#table_grid_tbl_app_version_list").bootstrapTable("getData");$.each(t,function(i){("^"+n._pr_gridselectids+"^").indexOf("^"+t[i].sys_id+"^")>-1&&(n._pr_gridselectids=("^"+n._pr_gridselectids+"^").replaceAll("^"+t[i].sys_id+"^","^"))});n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()}});t.success()}catch(f){_blockMessage.show("initGrid执行失败<br/>"+f.message,"fail")}},s=function(n){n?($("#btn_command_new_tbl_app_version_list").addClass("hidden"),$("#btn_command_delete_tbl_app_version_list").addClass("hidden")):($("#btn_command_new_tbl_app_version_list").removeClass("hidden"),$("#btn_command_delete_tbl_app_version_list").removeClass("hidden"))},o=function(t,i){var r="../tbl_app_version/tbl_app_version_detail.html";r+="?uid="+basePageObj._userInfoJson.sys_userid;r+="&sys_id="+t;r+="&pagetype="+i;r+="&appcode="+_pr_appcode;r+="&fromurl=../tbl_app_version/tbl_app_version_list.html";r+="&fromurlparam={";r+='"appcode":"'+_pr_appcode+'",';r+='"listtype":"'+n._pr_listtype+'",';r+='"gridselectids":"'+n._pr_gridselectids+'",';r+='"gridpageindex":"'+n._pr_gridpageindex+'",';r+='"searchtype":"'+n._pr_searchtype+'",';r+='"showtype":"'+n._pr_showtype+'",';r+='"searchcontent":'+JSON.stringify(n._pr_searchcontent)+"";r+="}";commonObj.changeUrl(r,"right-show")},h=function(t){e=n._pr_showtype=="true"?" f_apptype='ios'":" f_apptype='android'";t.success()},i=function(){if(n._pr_gridselectids=="")$("#btn_command_clearselect_tbl_app_version_list").addClass("hidden");else{$("#btn_command_clearselect_tbl_app_version_list").removeClass("hidden");var t=n._pr_gridselectids.split("^").length,i=$("#table_grid_tbl_app_version_list").bootstrapTable("getSelections").length;$("#btn_command_clearselect_tbl_app_version_list .cc-badge-p").html(i+"/"+t)}},v=function(t,i){n._pr_showtype=i==!0?"true":"false";h({success:function(){n.bindGrid({success:function(){}})}})},n={_pr_listtype:"",_pr_gridselectids:"",_pr_gridpageindex:1,_pr_searchtype:"1",_pr_searchcontent:null,_pr_showtype:"true",init:function(){try{_alertMessage=new alertMessage;_resultMessage=new resultMessage;_confirmMessage=new confirmMessage;_blockMessage=new blockMessage;_blockMessage.show("程序加载中...","loading");basePageObj.initBasePage({success:function(){l({success:function(){h({success:function(){a({success:function(){n.bindGrid({success:function(){c=new validateMessage("btn_search_modal_search_tbl_app_version_list");f=Ladda.create("btn_command_new_tbl_app_version_list");t=Ladda.create("btn_command_delete_tbl_app_version_list");switch(n._pr_listtype){case"1":s(!1);break;case"2":s(!0)}_blockMessage.hidden()}})}})}})}})},fail:function(n){_blockMessage.show(n,"fail")}})}catch(i){_blockMessage.show("程序初始化失败。<br/>"+i.message,"fail")}},bindGrid:function(t){setTimeout(function(){var f=e,o={whereString:f,orderByString:" f_appversion desc",columnsString:"f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^f_appversion^f_htmlversion^f_codeversion^f_colorversion^f_comment^f_status^f_apptype^f_appstatus^f_appstatusid^sys_id",pageSizeString:u,pageIndexString:n._pr_gridpageindex,clientInf:_clientInf};doAjaxFunction(r,"GetList",o,{success:function(n){var r=new Function("","return "+n)();$("#table_grid_tbl_app_version_list").bootstrapTable("loadJson",r);i();t!=undefined&&t!=null&&t.success()},fail:function(n){_blockMessage.show("bindGrid执行失败<br/>"+n,"fail")}})},0)},btn_command_new_onclick:function(){var u,e;f.start();var n=new Date,t="ios",i="ios";controlObj.toggle("detail_ck_showtype_tbl_app_version_list")=="false"&&(t="android",i="android");u={f_status:"false",f_appstatus:"开发",f_appstatusid:"1",f_apptype:t,f_apptypeid:i,f_value1:controlObj.fileuploadernewfileid(),sys_delflag:"0",sys_lasteditusername:basePageObj._userInfoJson.sys_username,sys_lastedituserid:basePageObj._userInfoJson.sys_userid,sys_lasteditdate:n.Format("yyyy-MM-dd hh:mm:ss"),sys_creatdate:n.Format("yyyy-MM-dd hh:mm:ss"),sys_creatusername:basePageObj._userInfoJson.sys_username,sys_creatuserid:basePageObj._userInfoJson.sys_userid};e={json:JSON.stringify(u),clientInf:_clientInf};doAjaxFunction(r,"Add",e,{success:function(n){f.stop();o(n,"1")},fail:function(n){_alertMessage.show("新建数据执行失败<br/>"+n,"fail");f.stop()}})},btn_command_delete_onclick:function(){var f=n._pr_gridselectids.split("^").length;if(n._pr_gridselectids=="")_alertMessage.show("至少选择一条数据!","warning",1e3);else{var o=$("#table_grid_tbl_app_version_list").bootstrapTable("getSelections").length,s=f-o,i="<blockquote> ";i+='<h3>将对被选中的全部数据<a style="color:red">'+f+'<\/a>条进行<a style="color:red">删除<\/a><\/h3>';i+="其中<br/>";i+='<h5><a style="color:red">当前页<\/a>的数据<a style="color:red">'+o+"<\/a>条<\/h5>";i+='<h5><a style="color:red">其他页<\/a>的数据<a style="color:red">'+s+"<\/a>条<\/h5>";i+="<\/blockquote> ";_confirmMessage.destory();_confirmMessage.show("删除确认？",i,{confirm:function(){t.start();var i="sys_id in ('"+n._pr_gridselectids.toString().replaceAll("^","','")+"')",f={whereString:i,orderByString:"",columnsString:"f_status",pageSizeString:"",pageIndexString:"",clientInf:_clientInf};doAjaxFunction(r,"GetList",f,{success:function(f){for(var h,s=new Function("","return "+f)(),o=0;o<s.rows.length;o++)if(s.rows[o].f_status=="true"){_alertMessage.show("不能将状态为true的信息删除！","删除失败",5e3);t.stop();break}else o==s.rows.length-1&&(h={clientInf:_clientInf,whereString:i},doAjaxFunction(r,"Delete",h,{success:function(){var i={clientInf:_clientInf,whereString:e};doAjaxFunction(r,"GetCount",i,{success:function(i){var r=parseInt(i);r<n._pr_gridpageindex*u&&(n._pr_gridpageindex=Math.ceil(r/u));n._pr_gridpageindex==0&&(n._pr_gridpageindex=1);n._pr_gridselectids="";n.bindGrid({success:function(){t.stop()}})},fail:function(n){_alertMessage.show("数据删除完成，获取数据条数失败<br/>"+n,"fail");t.stop()}})},fail:function(n){_alertMessage.show("数据删除失败<br/>"+n,"fail");t.stop()}}))},fail:function(n){_blockMessage.show("检查删除状态时出现错误<br/>"+n,"fail")}})},cancle:function(){_alertMessage.show("操作已取消","success",1e3)}})}},btn_command_clearselect_onclick:function(){$("#table_grid_tbl_app_version_list").bootstrapTable("uncheckAll");n._pr_gridselectids="";i()}};return n}();$(document).ready(function(){tbl_app_version_list_Obj.init()});