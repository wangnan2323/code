var _clientInf='{userid:"",appcode:"54",appname:"",userip:"",usermac:"",username:"",userimg:""}',_blockMessage=null,_alertMessage=null,_resultMessage=null,_confirmMessage=null,_pr_appcode="",_pr_tbl_maintable_sys_id="",_pr_pagetype_tbl_maintable_detailall="",_pr_projectClassId="",_pr_projectClassDtl1="",_pr_projectClassDtl2="",_pr_fromurl="",_pr_fromurlparam="",_pr_workItemIdString="",_pr_processDefIdString="",_pr_activityDefIdString="",_pr_processInsIdString="",tblMainTableDetailAllObject;$(document).ready(function(){tblMainTableDetailAllObject.init()});$(window).scroll(function(){tblMainTableDetailAllObject.onWindowScroll()});tblMainTableDetailAllObject=function(){"use strict";var f="//127.0.0.1/sara.dd.ldsw/service/service_tbl_maintable_detailall.asmx/",n=null,e=null,s="",h=200,t=!1,r=["icon-compass","icon-trello","icon-beer","icon-bell","icon-calendar-empty","icon-dashboard","icon-key","icon-legal","icon-group","icon-bar-char"],i="1",c=function(n){try{_pr_fromurl=requestQuery("fromurl");_pr_fromurlparam=requestQuery("fromurlparam");_pr_tbl_maintable_sys_id=requestQuery("sys_id");_pr_projectClassId=requestQuery("projectclassid");_pr_projectClassDtl1=requestQuery("projectclassdtl1");_pr_projectClassDtl2=requestQuery("projectclassdtl2");_pr_pagetype_tbl_maintable_detailall=requestQuery("pagetype");_pr_appcode=requestQuery("appcode");_pr_workItemIdString=requestQuery("workitemid");_pr_processDefIdString=requestQuery("processdefid");_pr_activityDefIdString=requestQuery("activitydefid");_pr_processInsIdString=requestQuery("processinsid");_clientInf='{userid:"'+basePageObj._userInfoJson.sys_userid+'",appcode:"'+_pr_appcode+'",appname:"",userip:"'+basePageObj._userInfoJson.ip+'",usermac:"'+basePageObj._userInfoJson.mac+'",username:"'+basePageObj._userInfoJson.sys_username+'",userimg:"'+basePageObj._userInfoJson.sys_photourl+'"}';(_pr_workItemIdString==undefined||_pr_workItemIdString==null)&&(_pr_workItemIdString="");(_pr_processDefIdString==undefined||_pr_processDefIdString==null)&&(_pr_processDefIdString="");(_pr_activityDefIdString==undefined||_pr_activityDefIdString==null)&&(_pr_activityDefIdString="");(_pr_processInsIdString==undefined||_pr_processInsIdString==null)&&(_pr_processInsIdString="");_pr_projectClassId==null||_pr_projectClassId==""||_pr_projectClassId=="null"?_blockMessage.show("projectClassid参数接收失败...","fail"):_pr_projectClassDtl1==null||_pr_projectClassDtl1==""||_pr_projectClassDtl1=="null"?_blockMessage.show("projectclassdtl1参数接收失败...","fail"):_pr_projectClassDtl2==null||_pr_projectClassDtl2==""||_pr_projectClassDtl2=="null"?_blockMessage.show("projectclassdtl2参数接收失败...","fail"):_pr_tbl_maintable_sys_id==null||_pr_tbl_maintable_sys_id==""||_pr_tbl_maintable_sys_id=="null"?_blockMessage.show("tbl_maintable_sys_id参数接收失败","fail"):_pr_pagetype_tbl_maintable_detailall==null||_pr_pagetype_tbl_maintable_detailall==""||_pr_tbl_maintable_sys_id=="null"?_blockMessage.show("pagetype参数接收失败...","fail"):n.success()}catch(t){_blockMessage.show("initParameter执行失败"+t.message,"fail")}},l=function(n){$("#div_log_modal_tbl_maintable_detailall").modal({keyboard:!1,backdrop:"static",show:!1});n.success()},u=function(n,t){var i={};i.targetDiv="div_"+n.nodeId;n.nodeUrl!=""?(i.url=n.nodeUrl,i.initFunctionName=n.nodeInitFunction,i.parameterHashMap=a(n.nodeParam),$("#"+i.targetDiv).load(i.url,null,function(){var n=i.parameterHashMap.keys(),r="",u;$.each(n,function(t){r+=n[t]+" = '"+i.parameterHashMap.get(n[t])+"';"});eval(r);u=eval(i.initFunctionName);u({success:function(){t&&t.success()}})})):t.success()},a=function(n){var t=new hashMap,i=n.split("^");return $.each(i,function(n){var u=i[n].split("="),r=u[1];r=r.replaceAll("[_pr_pagetype_tbl_maintable_detailall]",_pr_pagetype_tbl_maintable_detailall);r=r.replaceAll("[_pr_tbl_maintable_sys_id]",_pr_tbl_maintable_sys_id);r=r.replaceAll("[_pr_projectclassid]",_pr_projectClassId);r=r.replaceAll("[_pr_projectclassdtl1]",_pr_projectClassDtl1);r=r.replaceAll("[_pr_projectclassdtl2]",_pr_projectClassDtl2);t.put(u[0],r)}),t},o={onWindowScroll:function(){var f,r;if(i!="2"&&t){if(f=$(this).scrollTop(),Math.abs(s-f)<=h)return;s=f;r=n.keys();$.each(r,function(i){if(n.get(r[i]).isLoaded==!1&&$("#div_loading_"+r[i]).css("display")=="block"){var e=$("#div_loading_"+r[i]).offset().top,s="100",f=$(window).scrollTop(),o=$(window).height();e>f&&Number(e)+Number(s)<Number(f)+Number(o)&&t&&setTimeout(function(){f=$(window).scrollTop();o=$(window).height();e>f&&Number(e)+Number(s)<Number(f)+Number(o)&&t&&(n.get(r[i]).isLoaded=!0,t=!1,u(n.get(r[i]),{success:function(){$("#div_"+r[i]).css("display","");$("#div_loading_"+r[i]).css("display","none");t=!0}}))},500)}})}},init:function(){_blockMessage=new blockMessage;_alertMessage=new alertMessage;_resultMessage=new resultMessage;_confirmMessage=new confirmMessage;_blockMessage.show("程序加载中...","loading");basePageObj.initBasePage({success:function(){i=basePageObj.getUserCookie().detailAllMode;$(window).width()<basePageObj._padMinSrceenWidth&&(i="1");switch(i){case"1":$("#sp_detailAllMode_tbl_maintable_detailall").text("菜单模式：滚轮模式");break;case"2":$("#sp_detailAllMode_tbl_maintable_detailall").text("菜单模式：点击模式")}i=="1"?$("#div_row_fullscreen").height($(window).height()):($("#div_row_fullscreen").css("display","none"),$("#table_content_tbl_maintable_detailall").height($(document).height()-120),$(".td-menu-maintable-detailall").height($(document).height()-120),$("#div_menu_tbl_maintable_detailall").height($(window).height()-120));c({success:function(){l({success:function(){tblMainTableButtonObj.initButton(_pr_pagetype_tbl_maintable_detailall,"detail",{success:function(){o.initLattice({success:function(){_blockMessage.hidden()}})}})}})}})},fail:function(n){_blockMessage.show(n,"fail")}})},btn_command_cancle_onclick:function(){var n=_pr_fromurl,t;n+="?uid="+basePageObj._userInfoJson.sys_userid;t=new Function("","return "+_pr_fromurlparam)();$.each(t,function(t,i){n+=typeof i=="object"?"&"+t+"="+JSON.stringify(i):"&"+t+"="+i});commonObj.changeUrl(n,"right-hide")},initLattice:function(s){var h={sysUserIdString:basePageObj._userInfoJson.sys_userid,mainTableSysidString:_pr_tbl_maintable_sys_id,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,workItemIdString:_pr_workItemIdString,processDefIdString:_pr_processDefIdString,activityDefIdString:_pr_activityDefIdString,processInsIdString:_pr_processInsIdString,userInfoJsonString:JSON.stringify(basePageObj._userInfoJson)},c={parameterJsonString:JSON.stringify(h),clientInf:_clientInf};doAjaxFunction(f,"GetProjectClassDtlTableName",c,{success:function(f){var a=new Function("","return "+f)(),l="",h="",c="",v="";n=new hashMap;e=new hashMap;$.each(a,function(t){var u=a[t],f,s,o;u.isShow==!0&&(u.isSelected==!0&&(c=u,v=u.nodeId),l+='<li id="li_'+u.nodeId+'">',l+="<a onclick=\"tblMainTableDetailAllObject.menuOnClick('"+u.nodeId+'\');" href="#'+u.nodeId+'">',f=t%r.length,l+='<i class="'+r[f]+'"><\/i><span >'+u.nodeName+"<\/span>",l+="<\/a>",h+='<div class="div-businesswidget" id="div_'+u.nodeId+'">',h+='<div id="'+u.nodeId+'" class="business-title1"><i class="'+r[f]+'" ><\/i>'+u.nodeName+"<\/div>",u.nodeUrl!=""&&(h+='<div id="div_'+u.nodeId+'" style="display:none;"><\/div>',h+='<div id="div_loading_'+u.nodeId+'"  style="height:100px;" onclick="tblMainTableDetailAllObject.loadPlugInByNodeId(\''+u.nodeId+'\');"><img src="../../images/loading.gif" />数据装载中...<\/div>',n.put(u.nodeId,u)),u.childNodes.length>0&&(s=[],o=u.childNodes,$.each(o,function(t){var e=o[t];e.isShow==!0&&(s.push(e.nodeId),u.isSelected==!0&&e.isSelected==!0&&(c=e),h+='<div id="'+e.nodeId+'" class="business-title2">',o.length!=1&&(h+='<i class="'+r[f]+'"><\/i>',h+=e.nodeName),h+="<\/div>",e.nodeUrl!=""&&(h+=i=="1"?'<div id="div_'+e.nodeId+'" style="display:none;"><\/div>':'<div id="div_'+e.nodeId+'" style="display:none;"><\/div>',h+='<div id="div_loading_'+e.nodeId+'" style="height:100px;" onclick="tblMainTableDetailAllObject.loadPlugInByNodeId(\''+e.nodeId+'\');"><img src="../../images/loading.gif" />数据装载中...<\/div>',n.put(e.nodeId,e)))}),e.put(u.nodeId,s)),l+="<\/li>",h+="<\/div>",i=="1"&&(h+="<br/>"))});$("#ul_menu_tbl_maintable_detailall").html(l);$("#div_content_tbl_maintable_detailall").html(h);i=="1"?u(c,{success:function(){n.get(c.nodeId).isLoaded=!0;$("#div_"+c.nodeId).css("display","");$("#div_loading_"+c.nodeId).css("display","none");$(document.body).scrollspy({target:"#div_menu_tbl_maintable_detailall"});$(window).on("load",function(){$(document.body).scrollspy("refresh")});setTimeout(function(){try{$(window).scrollTop($("#"+c.nodeId).offset().top)}catch(n){$("html,body").animate({scrollTop:$("#"+c.nodeId).offset().top},100)}t=!0;s.success()},200)}}):o.menuOnClick(v,{success:function(){s.success()}})},fail:function(n){_blockMessage.show(f+"GetProjectClassDtlTableName<br/>"+n,"fail")},error:function(n){_blockMessage.show(f+"GetProjectClassDtlTableName<br/>"+n,"fail")}})},loadPlugInByNodeId:function(i){t&&(t=!1,u(n.get(i),{success:function(){n.get(i).isLoaded=!0;$("#div_"+i).css("display","");$("#div_loading_"+i).css("display","none");t=!0}}))},menuOnClick:function(t,r){var o,f;i=="2"&&($("#ul_menu_tbl_maintable_detailall>li").removeClass("active"),$("#li_"+t).addClass("active"),o=$("#div_content_tbl_maintable_detailall>.div-businesswidget"),$.each(o,function(n,i){var r=$(i);r.attr("id")=="div_"+t?r.css("display",""):r.css("display","none")}),f=e.get(t),setTimeout(function s(t){t=t||0;n.get(f[t]).isLoaded==!0?($("#div_"+f[t]).css("display",""),$("#div_loading_"+f[t]).css("display","none"),t>=f.length-1?r&&r.success():s(t+1)):u(n.get(f[t]),{success:function(){n.get(f[t]).isLoaded=!0;$("#div_"+f[t]).css("display","");$("#div_loading_"+f[t]).css("display","none");t>=f.length-1?(setTimeout(function(){var n=Math.max($("#div_"+f[t]).parent().height(),$(window).height()-120);$("#table_content_tbl_maintable_detailall").height(n);$(".td-menu-maintable-detailall").height(n);$("#div_menu_tbl_maintable_detailall").height($(window).height()-120)},0),r&&r.success()):s(t+1)}})},0,0))}};return o}();