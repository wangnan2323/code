var tblMainTableButtonObj=function(){"use strict";var n={_serviceUrl_tbl_maintable_detailall:"//127.0.0.1/sara.dd.ldsw/service/service_tbl_maintable_detailall.asmx/",_buttonHashMap:null,_ladda_buttonHashMap:null,_ladda_current_btn_command:null,_currentButtonJson:null,_currentType:"",_currentPageType:"",_validateMessage_div_input_modal:null,_validateMessage_div_workflow_modal_start:null,_validateMessage_div_workflow_modal_send:null,initButton:function(t,i,r){$("#div_tbl_maintable_button").load("../tbl_maintable/tbl_maintable_button.html",null,function(){n._currentPageType=t;n._currentType=i;n.loadButton(r)})},loadButton:function(t){$("#div_input_modal_tbl_maintable_button").modal({keyboard:!1,backdrop:"static",show:!1});$("#div_workflow_modal_tbl_maintable_button").modal({keyboard:!1,backdrop:"static",show:!1});n._ladda_btn_workflow_modal_start=Ladda.create("btn_workflow_modal_start_tbl_maintable_button");n._ladda_btn_workflow_modal_send=Ladda.create("btn_workflow_modal_send_tbl_maintable_button");n._validateMessage_div_input_modal=new validateMessage("btn_input_modal_confirm_tbl_maintable_button");n._validateMessage_div_workflow_modal_start=new validateMessage("btn_workflow_modal_start_tbl_maintable_button");n._validateMessage_div_workflow_modal_send=new validateMessage("btn_workflow_modal_send_tbl_maintable_button");var i={sysUserIdString:basePageObj._userInfoJson.sys_userid,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,workItemIdString:_pr_workItemIdString,processDefIdString:_pr_processDefIdString,activityDefIdString:_pr_activityDefIdString,processInsIdString:_pr_processInsIdString},r={parameterJsonString:JSON.stringify(i),clientInf:_clientInf};doAjaxFunction(n._serviceUrl_tbl_maintable_detailall,"GetProjectClassDtlButton",r,{success:function(i){n._buttonHashMap=new hashMap;n._ladda_buttonHashMap=new hashMap;var r=new Function("","return "+i)();$("#div_btn_command_tbl_maintable_button").html("");$.each(r,function(t){var u=!1,i;if(r[t].buttonShowType=="all"?u=!0:r[t].buttonShowType==n._currentType&&(u=!0),u){i="";i+="<button";i+=' id="'+r[t].buttonId+'"';switch(r[t].buttonCss){case"success":i+=' class="btn btn-success" ';break;case"warning":i+=' class="btn btn-warning" ';break;case"danger":i+=' class="btn btn-danger" ';break;case"primary":i+=' class="btn btn-primary" ';break;case"info":i+=' class="btn btn-info" ';break;case"magenta":i+=' class="btn btn-magenta" ';break;default:i+=' class="btn btn-success" '}r[t].buttonIsDisable&&(i+=" disabled ");i+=" onclick=\"tblMainTableButtonObj.btn_command_onclick('"+r[t].buttonId+"');\">";i+=r[t].buttonText;i+=' <span class="badge"><\/span>';i+=" <\/button>";$("#div_btn_command_tbl_maintable_button").append(i);n._ladda_buttonHashMap.put(r[t].buttonId,Ladda.create(r[t].buttonId));n._buttonHashMap.put(r[t].buttonId,r[t])}});t.success("1")},fail:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+"GetProjectClassDtlButton<br/>"+t,"fail")},error:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+"GetProjectClassDtlButton<br/>"+t,"fail")}})},toolGetTblMaintableSysId:function(){return n._currentType=="list"?tblMainTableListObj._pr_gridselectids:_pr_tbl_maintable_sys_id},btn_command_onclick:function(t){n._currentButtonJson=n._buttonHashMap.get(t);n._ladda_current_btn_command=n._ladda_buttonHashMap.get(t);n._ladda_current_btn_command.start();var i=n.toolGetTblMaintableSysId(),u=i.split("^").length,r=!1;n._currentButtonJson.buttonIsMustData!="true"?r=!0:i==""||i=="^"?(_alertMessage.show("需要选择一条数据!","warning",2e3),n._ladda_current_btn_command.stop(),n._currentButtonJson=null):u>=2?(_alertMessage.show("请选择一条数据!","warning",2e3),n._ladda_current_btn_command.stop(),n._currentButtonJson=null):r=!0;r&&n.doButtonConfirm(i,n._currentButtonJson,{confirm:function(){n.doButtonInput(i,n._currentButtonJson,{confirm:function(){n.doButtonServerEventArgs(i,n._currentButtonJson,{success:function(t){n.doButtonClientEventArgs(i,n._currentButtonJson,t,{success:function(){n._ladda_current_btn_command.stop();n._currentButtonJson=null},fail:function(){n._ladda_current_btn_command.stop();n._currentButtonJson=null}})},fail:function(t){n._ladda_current_btn_command.stop();n._currentButtonJson=null;t!=""&&(_resultMessage.message(t),_resultMessage.show())}})},cancle:function(){n._ladda_current_btn_command.stop();n._currentButtonJson=null}})},cancle:function(){n._ladda_current_btn_command.stop();n._currentButtonJson=null}})},doButtonConfirm:function(n,t,i){t.buttonConfirmContent!=undefined&&t.buttonConfirmContent!=null&&t.buttonConfirmContent!=""?(_confirmMessage.destory(),_confirmMessage.show("操作确认",t.buttonConfirmContent,{confirm:function(){i.confirm()},cancle:function(){i.cancle()}})):i.confirm()},doButtonInput:function(t,i,r){i.buttonInputTitle!=undefined&&i.buttonInputTitle!=null&&i.buttonInputTitle!=""?n.initButtonInputArgs(t,i,{success:function(){$("#label_input_log_tbl_maintable_button").html(i.buttonInputTitle);$("#h4_input_title_tbl_maintable_button").html(i.buttonInputTitle);$("#txt_input_log_tbl_maintable_button").val("已阅");$("#btn_input_modal_confirm_tbl_maintable_button").unbind("click");$("#btn_input_modal_confirm_tbl_maintable_button").bind("click",function(){var t=new hashMap,u=new hashMap;i.buttonInputArgs!=undefined&&i.buttonInputArgs!=null&&i.buttonInputArgs!=""&&controlObj.singledropdownlistid("dropdown_input_nextuser_tbl_maintable_button").length==0&&(t.put("dropdown_input_nextuser_tbl_maintable_button","不能为空"),u.put("dropdown_input_nextuser_tbl_maintable_button","right"));$("#txt_input_log_tbl_maintable_button").val().length==0&&(t.put("txt_input_log_tbl_maintable_button","不能为空"),u.put("txt_input_log_tbl_maintable_button","right"));$("#txt_input_log_tbl_maintable_button").val().length>2e3&&(t.put("txt_input_log_tbl_maintable_button","不能超过1000个汉字"),u.put("txt_input_log_tbl_maintable_button","right"));t.keys().length>0?n._validateMessage_div_input_modal.show(t,u,!0):(n._validateMessage_div_input_modal.hidden(),$("#div_input_modal_tbl_maintable_button").modal("hide"),r.confirm())});$("#btn_input_modal_cancle_tbl_maintable_button").unbind("click");$("#btn_input_modal_cancle_tbl_maintable_button").bind("click",function(){$("#div_input_modal_tbl_maintable_button").modal("hide");r.cancle()});$("#div_input_modal_tbl_maintable_button").modal("show")}}):r.confirm()},initButtonInputArgs:function(t,i,r){if(i.buttonInputArgs!=undefined&&i.buttonInputArgs!=null&&i.buttonInputArgs!=""){$("#div_dropdown_input_nextuser_tbl_maintable_button").css("display","");var u={sysUserIdString:basePageObj._userInfoJson.sys_userid,mainTableSysidString:t,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,buttonServerEventArgs:i.buttonServerEventArgs},f={parameterJsonString:JSON.stringify(u),clientInf:_clientInf};doAjaxFunction(n._serviceUrl_tbl_maintable_detailall,i.buttonInputArgs,f,{success:function(n){var t=new Function("","return "+n)();controlObj.singledropdownlistinit("dropdown_input_nextuser_tbl_maintable_button",t.nextuser);controlObj.singledropdownlistid("dropdown_input_nextuser_tbl_maintable_button","");r.success()},fail:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+i.buttonInputArgs+" <br/>"+t,"fail")},error:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+i.buttonInputArgs+" <br/>"+t,"fail")}})}else $("#div_dropdown_input_nextuser_tbl_maintable_button").css("display","none"),r.success()},doButtonServerEventArgs:function(t,i,r){var o,s;if(i.buttonServerEventArgs!=undefined&&i.buttonServerEventArgs!=null&&i.buttonServerEventArgs!=""){var f="",e="",u="";i.buttonInputTitle!=undefined&&i.buttonInputTitle!=null&&i.buttonInputTitle!=""&&(f=$("#txt_input_log_tbl_maintable_button").val().formatStringRN(),i.buttonInputArgs!=undefined&&i.buttonInputArgs!=null&&i.buttonInputArgs!=""&&(e=controlObj.singledropdownlistid("dropdown_input_nextuser_tbl_maintable_button"),u=controlObj.singledropdownlist("dropdown_input_nextuser_tbl_maintable_button")));o={sysUserIdString:basePageObj._userInfoJson.sys_userid,mainTableSysidString:t,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,buttonIdString:i.buttonId,eventArgsString:i.buttonServerEventArgs,InputContentString:f+"^"+e+"^"+u,workItemIdString:_pr_workItemIdString,processDefIdString:_pr_processDefIdString,activityDefIdString:_pr_activityDefIdString,processInsIdString:_pr_processInsIdString,userInfoJsonString:basePageObj._userInfoJson};s={parameterJsonString:JSON.stringify(o),clientInf:_clientInf};n.toolSendGetNextUserNameString(u);doAjaxFunction(n._serviceUrl_tbl_maintable_detailall,"DoButtonServerEventArgs",s,{success:function(n){r.success(n)},fail:function(n){r.fail(n)},error:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+"DoButtonServerEventArgs<br/>"+t,"fail")}})}else r.success("")},_doButtonServerEventArgsResultString:"",doButtonClientEventArgs:function(t,i,r,u){if(n._doButtonServerEventArgsResultString=r,i.buttonClientEventArgs!=""){var f=i.buttonClientEventArgs;f=f.split("(")[0];f=eval(f);typeof f=="function"?f(u):_blockMessage.show("未定义的"+i.buttonClientEventArgs,"fail")}else u.success()},setButtonVisiblity:function(t){var i=n._buttonHashMap.keys();$.each(i,function(r){var u=n._buttonHashMap.get(i[r]);u.buttonIsMustData=="true"&&t==0?$("#"+i[r]).css("display","none"):$("#"+i[r]).css("display","")})},btn_command_complete:function(t){if(n._nextUserNamesString!="")switch(n._currentType){case"list":tblMainTableListObj.bindGrid({success:function(){tblMainTableListObj.btn_command_clearselect_onclick();t!=undefined&&t.success()}});break;case"detail":$("#div_btn_command_tbl_maintable_button").addClass("hidden");_alertMessage.show("<small>转件操作完成!<br/>该案卷已推送给：<\/small><br/><h2>"+n._nextUserNamesString+"<h2/><small>3秒钟后自动跳转。<\/small>","success",3e3);setTimeout(function(){tblMainTableDetailAllObject.btn_command_cancle_onclick();t!=undefined&&t.success()},3e3)}else switch(n._currentType){case"list":tblMainTableListObj.bindGrid({success:function(){tblMainTableListObj.btn_command_clearselect_onclick();t!=undefined&&t.success()}});break;case"detail":tblMainTableDetailAllObject.btn_command_cancle_onclick();t!=undefined&&t.success()}},_ladda_btn_workflow_modal_start:null,_ladda_btn_workflow_modal_send:null,_userHashMap:null,_operationHashMap:null,_selected_zuId:"",btn_command_startworkflow:function(){var i=new Function("","return "+n._doButtonServerEventArgsResultString)(),t=null;switch(i[0].fk_dy_lc_sys_id){case"540003":try{t=tbl_ld_xzsb_detail_Obj}catch(r){}t!=undefined?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540008":try{t=tbl_ld_xzsb_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540004":try{t=tbl_ld_dyhlh_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540009":try{t=tbl_ld_ghsb_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540010":try{t=tbl_ld_ghsb_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540006":try{t=tbl_ld_xhhbt_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;case"540007":try{t=tbl_ld_xhhbt_detail_Obj}catch(r){}t!=null?(t.save({success:function(){t.disabled();n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});break;default:n.initWorkflowModal(i,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}$("#btn_workflow_modal_start_tbl_maintable_button").css("display","");$("#btn_workflow_modal_send_tbl_maintable_button").css("display","none")},btn_command_sendworkflow:function(){var t=new Function("","return "+n._doButtonServerEventArgsResultString)();t[0].fk_dy_lc_sys_id=="540004"?tbl_ld_dyhlh_detail_Obj!=undefined&&(tbl_ld_dyhlh_detail_Obj.save({success:function(){tbl_ld_dyhlh_detail_Obj.disabled();n.initWorkflowModal(t,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}})}}),n._ladda_current_btn_command.stop()):n.initWorkflowModal(t,{success:function(){$("#div_workflow_modal_tbl_maintable_button").modal("show")}});$("#btn_workflow_modal_start_tbl_maintable_button").css("display","none");$("#btn_workflow_modal_send_tbl_maintable_button").css("display","")},initWorkflowModal:function(t,i){var h,c,r,u,o,s,f,e;controlObj.text("workflow_text_czr_tbl_maintable_button",basePageObj._userInfoJson.sys_username);controlObj.text("workflow_text_czrid_tbl_maintable_button",basePageObj._userInfoJson.sys_username);controlObj.textdisable("workflow_text_czr_tbl_maintable_button",!0);h=new Date;controlObj.datetimeinit("workflow_datetime_czrq_tbl_maintable_button_date","workflow_datetime_czrq_tbl_maintable_button_time");controlObj.datetime("workflow_datetime_czrq_tbl_maintable_button_date","workflow_datetime_czrq_tbl_maintable_button_time",h.Format("yyyy-MM-dd hh:mm:ss"));controlObj.datetimedisable("workflow_datetime_czrq_tbl_maintable_button_date","workflow_datetime_czrq_tbl_maintable_button_time",!0);controlObj.text("workflow_txt_shyj_tbl_maintable_button","已阅");c=[{id:"0",text:"请领导审核。"},{id:"1",text:"请领导审批。"},{id:"2",text:"同意。"},{id:"3",text:"拟同意。"},{id:"4",text:"请领导阅示。"},{id:"5",text:"阅。"},{id:"6",text:"已阅。"}];controlObj.radiolistinit("workflow_list_shyjlb_tbl_maintable_button",c,n.clickWorkflow_list_shyjlb_onclick,{width:100});r=[];u=new hashMap;n._userHashMap=new hashMap;n._operationHashMap=new hashMap;t.sort(function(n,t){return Number(n.operation_class_id)>Number(t.operation_class_id)?1:-1});o="";$.each(t,function(i){switch(t[i].operation_class_id){case"0":case"1":case"2":case"5":case"6":case"7":case"9":u.containsKey("0")||r.push({zuId:"0",zuText:"通过"});u=n.toolPushObjectInHashMapArray(u,"0",t[i].sys_id);t[i].zuid="0";t[i].zuname="通过";break;case"3":case"8":u.containsKey("1")||r.push({zuId:"1",zuText:"退回"});u=n.toolPushObjectInHashMapArray(u,"1",t[i].sys_id);t[i].zuid="1";t[i].zuname="退回";break;case"4":u.containsKey("2")||r.push({zuId:"2",zuText:"驳回"});u=n.toolPushObjectInHashMapArray(u,"2",t[i].sys_id);t[i].zuid="2";t[i].zuname="驳回";break;case"10":u.containsKey("3")||r.push({zuId:"3",zuText:"返回"});u=n.toolPushObjectInHashMapArray(u,"3",t[i].sys_id);t[i].zuid="3";t[i].zuname="返回"}t[i].iselected=="+0"&&o==""&&(o=t[i].zuid);switch(t[i].iselected){case"0":t[i].iselected="0";break;case"+0":t[i].iselected="0";break;case"1":t[i].iselected="0";break;case"+1":t[i].iselected="0";break;case"-1":t[i].iselected="-1";break;case"-2":t[i].iselected="-1"}var f=[],e=t[i].userids.split(","),s=t[i].usernames.split(",");$.each(e,function(n){f.push({id:e[n].replaceAll("-",""),text:s[n].replaceAll("-","")})});n._userHashMap.put(t[i].sys_id,f);n._operationHashMap.put(t[i].sys_id,t[i])});r.sort(function(n,t){return Number(n.zuId)>Number(t.zuId)?-1:1});o==""&&(s=$.grep(t,function(n){return n.iselected=="0"&&n.zuid=="0"}),o=s.length>0?s[0].zuid:t[0].zuid);f="";e="";$.each(r,function(t){var i=!1,s;o!=""?o==r[t].zuId&&(i=!0):t==0&&(i=!0);i?(f+='<li class="active">',n._selected_zuId=r[t].zuId):f+="<li>";r[t].zuId=="0"?(f+='<a href="#div_content_workflow_useroperation_'+r[t].zuId+'_tbl_maintable_button" class="a-color-success-tbl-maintable-button"  data-toggle="tab">',f+=r[t].zuText,f+='<i class="glyphicon glyphicon-chevron-right font-color-success-tbl-maintable-button"><\/i>'):(f+='<a href="#div_content_workflow_useroperation_'+r[t].zuId+'_tbl_maintable_button" class="a-color-danger-tbl-maintable-button"  data-toggle="tab">',f+='<i class="glyphicon glyphicon-chevron-left font-color-danger-tbl-maintable-button"><\/i>',f+=r[t].zuText);f+="<\/a>";f+="<\/li>";e+='<div id="div_content_workflow_useroperation_'+r[t].zuId+'_tbl_maintable_button"';e+=i?'class="tab-pane fade in active">':'class="tab-pane fade ">';e+='<div class="row div-row-useroperation-tbl-maintable-button">';s=u.get(r[t].zuId);e+=n.toolCreatUserOperationCard(r[t].zuId,s);e+="<\/div>";e+="<\/div>"});$("#ul_workflow_useroperation_tbl_maintable_button").html(f);$("#div_workflow_useroperation_tbl_maintable_button").html(e);n.toolBindControl();$("#ul_workflow_useroperation_tbl_maintable_button a").click(function(t){t.preventDefault();$(this).tab("show");n._selected_zuId=$(this)[0].hash.split("_")[4]});i.success()},toolCreatUserOperationCard:function(t,i){var r="";return $.each(i,function(u){var f=n._operationHashMap.get(i[u]),e;r+='<div class="col-lg-3 ">';e="color-success";t!="0"&&(e="clolr-danger");r+='<div id="div_workflow_well_'+t+"_"+f.sys_id+'_tbl_maintable_button" class="well0-tbl-maintable-button '+e+'">';r+="<table>";r+="<tr>";r+='<td class="td-left-tbl-maintable-button">';r+=f.operation_class_id!="7"?'<h3 class="hand" onclick="tblMainTableButtonObj.clickWorkflow_a_onclick(\''+t+"','"+f.sys_id+"')\">":"<h3>";r+="<strong>"+f.ljxslmc+"<\/strong>";r+="<\/h3>";r+="<\/td>";r+='<td  class="td-right-tbl-maintable-button">';f.operation_class_id!="7"&&(r+='<a class="hand"  onclick="tblMainTableButtonObj.clickWorkflow_a_onclick(\''+t+"','"+f.sys_id+'\')" title="选中">',r+='<i class="glyphicon glyphicon-ok-sign"><\/i>',r+="<\/a>");r+="<\/td>";r+="<\/tr>";r+="<\/table>";r+='<div id="div_workflow_dropdown_'+t+"_"+f.sys_id+'_tbl_maintable_button" class="form-group">';r+='<label for="workflow_dropdown_'+t+"_"+f.sys_id+'_tbl_maintable_button" class="control-label">待办人<i class="icon-exclamation-sign hand hidden"><\/i><\/label>';r+='<input type="hidden" id="workflow_dropdown_'+t+"_"+f.sys_id+'_tbl_maintable_button" />';r+="<\/div>";r+="<\/div>";r+="<\/div>"}),r},toolBindControl:function(){var t=n._operationHashMap.keys();$.each(t,function(i){var r=n._operationHashMap.get(t[i]),o=n._userHashMap.get(t[i]),u,e,f;controlObj.multidropdownlistinit("workflow_dropdown_"+r.zuid+"_"+t[i]+"_tbl_maintable_button",o,n.clickWorkflow_dropdown_onchange);u=r.userids.split(",");e="";$.each(u,function(n){u[n].indexOf("-")>-1||(e+=u[n]+",")});controlObj.multidropdownlistid("workflow_dropdown_"+r.zuid+"_"+t[i]+"_tbl_maintable_button",e.trimEnd(","));f=$("#div_workflow_well_"+r.zuid+"_"+t[i]+"_tbl_maintable_button");r.iselected=="0"?(r.zuid=="0"?f.attr("class","well0-tbl-maintable-button color-success"):f.attr("class","well0-tbl-maintable-button color-danger"),controlObj.multidropdownlistdisable("workflow_dropdown_"+r.zuid+"_"+t[i]+"_tbl_maintable_button",!1)):(f.attr("class","well-1-tbl-maintable-button"),controlObj.multidropdownlistdisable("workflow_dropdown_"+r.zuid+"_"+t[i]+"_tbl_maintable_button",!0))})},clickWorkflow_dropdown_onchange:function(t){for(var e,o,u,c=t.currentTarget.id.split("_"),v=c[2],r=c[3],f=t.val,s=n._operationHashMap.get(r).userids.replaceAll("-","")+",",l=n._operationHashMap.get(r).userids.replaceAll("-","").split(","),a=n._operationHashMap.get(r).usernames.replaceAll("-","").split(","),h=new hashMap,i=0;i<l.length;i++)h.put(l[i],a[i]);for(e="",o="",i=0;i<f.length;i++)e+=f[i]+",",o+=h.get(f[i])+",",s=s.replaceAll(f[i]+",","");for(u=s.split(","),i=0;i<u.length;i++)u[i]!=""&&(e+="-"+u[i]+",",o+="-"+h.get(u[i])+",");n._operationHashMap.get(r).userids=e.trimStartEnd(",");n._operationHashMap.get(r).usernames=o.trimStartEnd(",")},clickWorkflow_a_onclick:function(t,i){var r=n._operationHashMap.get(i),u;r.operation_class_id=="7"||(u=$("#div_workflow_well_"+t+"_"+i+"_tbl_maintable_button"),r.iselected=="0"?(u.attr("class","well-1-tbl-maintable-button"),controlObj.multidropdownlistdisable("workflow_dropdown_"+t+"_"+i+"_tbl_maintable_button",!0),r.iselected="-1"):(r.zuid=="0"?u.attr("class","well0-tbl-maintable-button color-success"):u.attr("class","well0-tbl-maintable-button color-danger"),controlObj.multidropdownlistdisable("workflow_dropdown_"+t+"_"+i+"_tbl_maintable_button",!1),r.iselected="0"))},clickWorkflow_list_shyjlb_onclick:function(){$("#workflow_txt_shyj_tbl_maintable_button").val(controlObj.radiolist("workflow_list_shyjlb_tbl_maintable_button"))},btn_workflow_modal_start_onclick:function(){var i,r;n._ladda_btn_workflow_modal_start.start();var t=n.toolResultArray(),u=t[0].fk_dy_lc_sys_id,f=n.toolGetTblMaintableSysId(),e=n.toolCheckUserOperation(t,"start");e?(i={sysUserIdString:basePageObj._userInfoJson.sys_userid,mainTableSysidString:f,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,buttonIdString:n._currentButtonJson.buttonId,eventArgsString:n._currentButtonJson.buttonServerEventArgs,processdefidString:u,czrIdString:basePageObj._userInfoJson.sys_userid,czrNameString:basePageObj._userInfoJson.sys_username,shyjString:controlObj.text("workflow_txt_shyj_tbl_maintable_button").formatStringRN(),userOperationString:t},r={parameterJsonString:JSON.stringify(i),clientInf:_clientInf},doAjaxFunction(n._serviceUrl_tbl_maintable_detailall,"DoStartWorkflow",r,{success:function(){n.toolWorkFlowNextUserNameString(t);$("#div_workflow_modal_tbl_maintable_button").modal("hide");n._ladda_current_btn_command.stop();n._currentButtonJson=null;n._ladda_btn_workflow_modal_start.stop();n.btn_command_complete()},fail:function(t){$("#div_workflow_modal_tbl_maintable_button").modal("hide");n._ladda_current_btn_command.stop();n._currentButtonJson=null;n._ladda_btn_workflow_modal_start.stop();t!=""&&(_resultMessage.message(t),_resultMessage.show())},error:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+"DoStartWorkflow<br/>"+t,"fail")}})):n._ladda_btn_workflow_modal_start.stop()},btn_workflow_modal_send_onclick:function(){var i,r,u,f;n._ladda_btn_workflow_modal_send.start();var t=n.toolResultArray(),e=n.toolGetTblMaintableSysId(),o=n.toolCheckUserOperation(t,"send");o?(i="0",r=$.grep(t,function(n){return n.iselected=="0"&&",2,".indexOf(","+n.operation_class_id+",")>-1}),r.length>0&&(i="1"),r=$.grep(t,function(n){return n.iselected=="0"&&",4,".indexOf(","+n.operation_class_id+",")>-1}),r.length>0&&(i="2"),u={sysUserIdString:basePageObj._userInfoJson.sys_userid,mainTableSysidString:e,projectClassIdString:_pr_projectClassId,projectClassDtl1String:_pr_projectClassDtl1,projectClassDtl2String:_pr_projectClassDtl2,buttonIdString:n._currentButtonJson.buttonId,eventArgsString:n._currentButtonJson.buttonServerEventArgs,workItemIdString:_pr_workItemIdString,processDefIdString:_pr_processDefIdString,activityDefIdString:_pr_activityDefIdString,processInsIdString:_pr_processInsIdString,czrIdString:basePageObj._userInfoJson.sys_userid,czrNameString:basePageObj._userInfoJson.sys_username,shyjString:controlObj.text("workflow_txt_shyj_tbl_maintable_button").formatStringRN(),workflowOverString:i,userOperationString:t},f={parameterJsonString:JSON.stringify(u),clientInf:_clientInf},doAjaxFunction(n._serviceUrl_tbl_maintable_detailall,"DoSendWorkflow",f,{success:function(){n.toolWorkFlowNextUserNameString(t);$("#div_workflow_modal_tbl_maintable_button").modal("hide");n._ladda_current_btn_command.stop();n._currentButtonJson=null;n._ladda_btn_workflow_modal_send.stop();n.btn_command_complete()},fail:function(t){$("#div_workflow_modal_tbl_maintable_button").modal("hide");n._ladda_current_btn_command.stop();n._currentButtonJson=null;n._ladda_btn_workflow_modal_send.stop();t!=""&&(_resultMessage.message(t),_resultMessage.show())},error:function(t){_blockMessage.show(n._serviceUrl_tbl_maintable_detailall+"DoSendWorkflow<br/>"+t,"fail")}})):n._ladda_btn_workflow_modal_send.stop()},toolResultArray:function(){var t=[],i=n._operationHashMap.keys();return $.each(i,function(r){var u=n._operationHashMap.get(i[r]),f;u.userids=u.userids;u.usernames=u.usernames;u.zuid!=n._selected_zuId?u.iselected="-1":(f=$("#div_workflow_well_"+u.zuid+"_"+u.sys_id+"_tbl_maintable_button").attr("class"),f.indexOf("well0")>-1&&u.iselected=="-1"?u.iselected="0":f.indexOf("well-1")>-1&&u.iselected=="0"&&(u.iselected="-1"));t.push(u)}),t},toolCheckUserOperation:function(t,i){var f=null,u,e,r;switch(i){case"start":f=n._validateMessage_div_workflow_modal_start;break;case"send":f=n._validateMessage_div_workflow_modal_send}return f.hidden(),u=new hashMap,e=new hashMap,controlObj.text("workflow_txt_shyj_tbl_maintable_button").length==0&&u.put("workflow_txt_shyj_tbl_maintable_button","审核意见不能为空。"),r=$.grep(t,function(n){return n.iselected=="0"&&",0,1,2,3,4,5,6,8,9,10".indexOf(","+n.operation_class_id+",")>-1}),r.length<=0&&u.put("ul_workflow_useroperation_tbl_maintable_button","除远程连接线，至少选择一条连接线。"),r=$.grep(t,function(n){return n.iselected=="0"&&",3,".indexOf(","+n.operation_class_id+",")>-1}),r.length>1&&u.put("ul_workflow_useroperation_tbl_maintable_button","如果选择退回连接线，则只能选择一条。"),r=$.grep(t,function(n){return n.iselected=="0"&&",1,".indexOf(","+n.operation_class_id+",")>-1}),r.length>1&&u.put("ul_workflow_useroperation_tbl_maintable_button","如果开始连接线，则只能选择一条。"),r=$.grep(t,function(n){return n.iselected=="0"}),$.each(r,function(n){var i=r[n].userids.split(","),t=0,f=0;$.each(i,function(n){i[n]==""||(i[n].indexOf("-")>-1?f++:t++)});switch(r[n].operation_class_id){case"0":case"1":r[n].userids.trimStartEnd(" ","")==""?u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内不能没有用户。"):r[n].jdnyh=="1"?t!=1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内只能选择一个用户。"):t<1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内至少选择一个用户。");break;case"3":r[n].userids.trimStartEnd(" ","")==""?u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内不能没有用户。"):t!=1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内只能选择一个退回用户。");break;case"7":r[n].userids.trimStartEnd(" ","")==""?u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内不能没有用户。"):t!=1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内只能选择一个用户。");break;case"8":case"9":r[n].userids.trimStartEnd(" ","")==""?u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内不能没有用户。"):t!=1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内只能选择一个用户。");break;case"10":r[n].userids.trimStartEnd(" ","")==""?u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内不能没有用户。"):t!=1&&u.put("workflow_dropdown_"+r[n].zuid+"_"+r[n].sys_id+"_tbl_maintable_button","当前选项内只能选择一个用户。")}}),i=="send"&&(r=$.grep(t,function(n){return n.iselected=="0"&&",1,3,".indexOf(","+n.fk_dy_jd_sys_id_from_lx+",")>-1&&",0,1,2,3,4,5,6,8,9,10".indexOf(","+n.operation_class_id+",")>-1}),r.length>1&&u.put("ul_workflow_useroperation_tbl_maintable_button","当前节点只有1个出口，除远程连接线外，只能选择一条连接线。")),u.keys().length>0?(f!=null&&f.show(u,e,!0),!1):(f!=null&&f.hidden(),!0)},btn_workflow_modal_cancle_onclick:function(){$("#div_workflow_modal_tbl_maintable_button").modal("hide");n._ladda_current_btn_command.stop();n._ladda_btn_workflow_modal_start.stop();n._ladda_btn_workflow_modal_send.stop();n._currentButtonJson=null;n._validateMessage_div_workflow_modal_start!=null&&n._validateMessage_div_workflow_modal_start.hidden();n._validateMessage_div_workflow_modal_send!=null&&n._validateMessage_div_workflow_modal_send.hidden()},toolPushObjectInHashMapArray:function(n,t,i){if(n.containsKey(t)){var r=n.get(t);r.push(i);n.put(t,r)}else n.put(t,[i]);return n},_nextUserNamesString:"",toolWorkFlowNextUserNameString:function(t){n._nextUserNamesString="";var i=$.grep(t,function(n){return n.iselected=="0"&&",0,1,2,3,4,5,6,8,9,10".indexOf(","+n.operation_class_id+",")>-1});$.each(i,function(t){var r=i[t].usernames.split(",");$.each(r,function(t){r[t].indexOf("-")>-1||(n._nextUserNamesString+=r[t]+",")})});n._nextUserNamesString=n._nextUserNamesString.trimStartEnd(",")},toolSendGetNextUserNameString:function(t){n._nextUserNamesString="";n._nextUserNamesString=t},btn_command_refresh:function(){n.loadButton({success:function(){}})},btn_command_ld:function(){n.btn_command_complete()}};return n}();