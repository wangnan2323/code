var tbl_app_news_discuss_list_Obj=function(){"use strict";var o="//127.0.0.1/sara.dd.ldsw/service/service_tbl_app_news_discuss.asmx/",r="10",c=null,s=null,u=null,f="",t="",l=function(t){try{n._pr_gridpageindex=n._pr_gridpageindex==null||n._pr_gridpageindex==""||n._pr_gridpageindex=="null"?1:Number(n._pr_gridpageindex);n._pr_listtype==null||n._pr_listtype==""||n._pr_listtype=="null"?_blockMessage.show("listtype参数接收失败...","fail"):t.success()}catch(i){_blockMessage.show("initParameter执行失败"+i.message,"fail")}},a=function(u){try{$("#table_grid_tbl_app_news_discuss_list").bootstrapTable({cache:!1,height:770,striped:!0,pagination:!0,pageSize:r,pageList:[r],pageNumber:n._pr_gridpageindex,search:!1,showColumns:!1,showRefresh:!1,clickToSelect:!0,idField:"sys_id",sidePagination:"webserver",columns:[{field:"_checkbox",checkbox:!0,formatter:function(t,i){switch(n._pr_listtype){case"1":return("^"+n._pr_gridselectids+"^").indexOf("^"+i.sys_id+"^")>-1?{disabled:!1,checked:!0}:t;case"2":return("^"+n._pr_gridselectids+"^").indexOf("^"+i.sys_id+"^")>-1?{disabled:!0,checked:!0}:{disabled:!0}}}},{field:"sys_id",title:"sys_id",align:"center",valign:"middle",visible:!1,sortable:!0},{field:"f_value1",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value2",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value3",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value4",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value5",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value6",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value7",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value8",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value9",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_value10",title:"",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"fk_tbl_app_news_sys_id",title:"新闻表主键id",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_nodeid",title:"nodeid","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"fk_t_user_id",title:"用户id",visible:!1,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_userimg",title:"用户头像",visible:!0,"class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){var t=commonObj.getUserPhotoUrlByFileName(n);return['<img src="'+t+'" style="max-width:50px;max-height:50px;" />'].join("")}},{field:"f_username",title:"用户名","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"f_discusscontent",title:"评论内容","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n.substr(0,4)+"..."}},{field:"sys_lasteditdate",title:"发表时间","class":"cc-hidden-sm  cc-hidden-xs",align:"center",valign:"middle",sortable:!0,clickToSelect:!0,formatter:function(n){return n}},{field:"",title:"操作",align:"center",valign:"middle",sortable:!1,clickToSelect:!1,formatter:function(){switch(n._pr_listtype){case"1":return'<a class="edit ml10" href="javascript:void(0)" title="编辑"><i class="glyphicon glyphicon-edit"><\/i><\/a>';case"2":return'<a class="view ml10" href="javascript:void(0)" title="浏览"><i class="glyphicon glyphicon-eye-open"><\/i><\/a>'}},events:{"click .view":function(n,t,i){e(i.sys_id,"2")},"click .edit":function(n,t,i){e(i.sys_id,"1")}}}],onPageChange:function(t,i){n._pr_gridpageindex=i;n.bindGrid()},rowStyle:function(n){return n.sys_id==t?{classes:"info"}:{}},onLoadSuccess:function(){},onCheck:function(t){n._pr_gridselectids+="^"+t.sys_id;n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onUncheck:function(t){n._pr_gridselectids=("^"+n._pr_gridselectids+"^").replaceAll("^"+t.sys_id+"^","^");n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onCheckAll:function(){var t=$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("getSelections");$.each(t,function(i){("^"+n._pr_gridselectids+"^").indexOf("^"+t[i].sys_id+"^")>-1||(n._pr_gridselectids+="^"+t[i].sys_id)});n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()},onUncheckAll:function(){var t=$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("getData");$.each(t,function(i){("^"+n._pr_gridselectids+"^").indexOf("^"+t[i].sys_id+"^")>-1&&(n._pr_gridselectids=("^"+n._pr_gridselectids+"^").replaceAll("^"+t[i].sys_id+"^","^"))});n._pr_gridselectids=n._pr_gridselectids.trimStartEnd("^");i()}});u.success()}catch(f){_blockMessage.show("initGrid执行失败<br/>"+f.message,"fail")}},h=function(n){n?($("#btn_command_new_tbl_app_news_discuss_list").addClass("hidden"),$("#btn_command_delete_tbl_app_news_discuss_list").addClass("hidden")):($("#btn_command_new_tbl_app_news_discuss_list").removeClass("hidden"),$("#btn_command_delete_tbl_app_news_discuss_list").removeClass("hidden"))},e=function(i){t=i;tbl_app_news_discuss_detail_Obj._pr_sys_id=i;tbl_app_news_discuss_detail_Obj.bindPage({success:function(){$("#div_content_part_tbl_app_news_discuss_detail").css("display","")}});tbl_app_news_like_discuss_modallist_Obj._pr_tbl_app_news_discuss_sys_id=i;tbl_app_news_like_discuss_modallist_Obj.bindGrid({success:function(){}});n.bindGrid()},v=function(n){n.success()},i=function(){if(n._pr_gridselectids=="")$("#btn_command_clearselect_tbl_app_news_discuss_list").addClass("hidden");else{$("#btn_command_clearselect_tbl_app_news_discuss_list").removeClass("hidden");var t=n._pr_gridselectids.split("^").length,i=$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("getSelections").length;$("#btn_command_clearselect_tbl_app_news_discuss_list .cc-badge-p").html(i+"/"+t)}},n={_pr_listtype:"",_pr_gridselectids:"",_pr_gridpageindex:1,_pr_searchtype:"1",_pr_searchcontent:null,_pr_maintable_sys_id:"",_pr_fk_tbl_app_news_sys_id:"",init:function(t){try{l({success:function(){v({success:function(){a({success:function(){n.bindGrid({success:function(){c=new validateMessage("btn_search_modal_search_tbl_app_news_discuss_list");s=Ladda.create("btn_command_new_tbl_app_news_discuss_list");u=Ladda.create("btn_command_delete_tbl_app_news_discuss_list");switch(n._pr_listtype){case"1":h(!1);break;case"2":h(!0)}t.success()}})}})}});$("#div_content_part_tbl_app_news_discuss_detail").load("../tbl_app_news_discuss/tbl_app_news_discuss_detail_part.html",null,function(){tbl_app_news_discuss_detail_Obj._pr_pagetype=n._pr_listtype;tbl_app_news_discuss_detail_Obj.init({success:function(){}})})}})}catch(i){_blockMessage.show("程序初始化失败。<br/>"+i.message,"fail")}},bindGrid:function(u){setTimeout(function(){f.length!=0&&(f+=" and ");f+=" fk_tbl_app_news_sys_id ='"+n._pr_fk_tbl_app_news_sys_id+"' ";var s=f,h={whereString:s,orderByString:" f_nodeid asc",columnsString:"f_value1^f_value2^f_value3^f_value4^f_value5^f_value6^f_value7^f_value8^f_value9^f_value10^sys_lasteditdate^fk_tbl_app_news_sys_id^f_discusscontent^f_nodeid^fk_t_user_id^f_username^f_userimg^sys_id",pageSizeString:r,pageIndexString:n._pr_gridpageindex,clientInf:_clientInf};doAjaxFunction(o,"GetList",h,{success:function(r){var f=new Function("","return "+r)(),s,o;if(f.rows.length>0){for($("#div_content_part_tbl_app_news_discuss_detail").css("display",""),$("#div_tbl_app_news_like_discuss").css("display",""),$("#div_loading_content4").css("display","none"),s=!1,o=0;o<f.rows.length;o++)if(f.rows[o].sys_id==t){s=!0;break}s||(t="");u!=undefined&&u!=null?t!=""?e(t,n._pr_listtype):e(f.rows[0].sys_id,n._pr_listtype):t==""&&e(f.rows[0].sys_id,n._pr_listtype)}else $("#div_content_part_tbl_app_news_discuss_detail").css("display","none"),$("#div_tbl_app_news_like_discuss").css("display","none"),$("#div_loading_content4").css("display","");$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("loadJson",f);i();u!=undefined&&u!=null&&u.success()},fail:function(n){_blockMessage.show("bindGrid执行失败<br/>"+n,"fail")}})},0)},btn_command_new_onclick:function(){s.start();var t=new Date,i={sys_delflag:"0",fk_tbl_app_news_sys_id:n._pr_fk_tbl_app_news_sys_id,sys_lasteditusername:basePageObj._userInfoJson.sys_username,sys_lastedituserid:basePageObj._userInfoJson.sys_userid,sys_lasteditdate:t.Format("yyyy-MM-dd hh:mm:ss"),sys_creatdate:t.Format("yyyy-MM-dd hh:mm:ss"),sys_creatusername:basePageObj._userInfoJson.sys_username,sys_creatuserid:basePageObj._userInfoJson.sys_userid},r={json:JSON.stringify(i),clientInf:_clientInf};doAjaxFunction(o,"Add",r,{success:function(){s.stop();n.bindGrid()},fail:function(n){_alertMessage.show("新建数据执行失败<br/>"+n,"fail");s.stop()}})},btn_command_delete_onclick:function(){var i=n._pr_gridselectids.split("^").length;if(n._pr_gridselectids=="")_alertMessage.show("至少选择一条数据!","warning",1e3);else{var e=$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("getSelections").length,s=i-e,t="<blockquote> ";t+='<h3>将对被选中的全部数据<a style="color:red">'+i+'<\/a>条进行<a style="color:red">删除<\/a><\/h3>';t+="其中<br/>";t+='<h5><a style="color:red">当前页<\/a>的数据<a style="color:red">'+e+"<\/a>条<\/h5>";t+='<h5><a style="color:red">其他页<\/a>的数据<a style="color:red">'+s+"<\/a>条<\/h5>";t+="<\/blockquote> ";_confirmMessage.destory();_confirmMessage.show("删除确认？",t,{confirm:function(){u.start();var t="sys_id in ('"+n._pr_gridselectids.toString().replaceAll("^","','")+"')",i={clientInf:_clientInf,whereString:t};doAjaxFunction(o,"Delete",i,{success:function(){var t={clientInf:_clientInf,whereString:f};doAjaxFunction(o,"GetCount",t,{success:function(t){var i=parseInt(t);i<n._pr_gridpageindex*r&&(n._pr_gridpageindex=Math.ceil(i/r));n._pr_gridpageindex==0&&(n._pr_gridpageindex=1);n._pr_gridselectids="";n.bindGrid({success:function(){u.stop()}})},fail:function(n){_alertMessage.show("数据删除完成，获取数据条数失败<br/>"+n,"fail");u.stop()}})},fail:function(n){_alertMessage.show("数据删除失败<br/>"+n,"fail");u.stop()}})},cancle:function(){_alertMessage.show("操作已取消","success",1e3)}})}},btn_command_clearselect_onclick:function(){$("#table_grid_tbl_app_news_discuss_list").bootstrapTable("uncheckAll");n._pr_gridselectids="";i()}};return n}();