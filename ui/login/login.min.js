var _blockMessage="",_alertMessage=null,login_Obj=function(){"use strict";var f="//127.0.0.1/sara.dd.ldsw/service/service_login.asmx/",o=null,r=null,i=null,e="",s=!1,t="",u="",n={init:function(){var t,u,f;_alertMessage=new alertMessage;t=getBrowerVersion();u=t.browser+"_"+t.version;u=="IE_7.0"?window.location.href="../browerversion/browerversion.html":u=="IE_8.0"&&_alertMessage.show('您的浏览器版本太低，您可以<a href="//127.0.0.1/sara.resource.library/html/MSIE678.html">更换新版浏览器<\/a>以获取更好的浏览体验',"warning",5e3);$.supersized({slide_interval:4e4,transition:1,transition_speed:1e4,performance:1,min_width:0,min_height:0,vertical_center:1,horizontal_center:1,fit_always:0,fit_portrait:1,fit_landscape:0,slide_links:"blank",slides:[{image:"//127.0.0.1/sara.resource.library/images/login-bg-0.jpg"}]});r=Ladda.create("btn_login_password");i=Ladda.create("btn_autologin");f=getCookie("isautologin");f=="true"?$("#ck_isautologin").bootstrapSwitch("state",!0):$("#ck_isautologin").bootstrapSwitch("state",!1);$("#ck_isautologin").on("switchChange.bootstrapSwitch",function(n,t){setCookie("isautologin",t,30)});$("#div_pattern_modal").modal({show:!1});$("#div_autologin_modal").modal({keyboard:!1,backdrop:"static",show:!1});$("#txt_userloginname,#txt_userpassword").bind("keyup",function(t){t.keyCode=="13"&&n.btn_login_password_onclick()});n.autologin_requestparameter({autologinfalse:function(){f=="true"?n.autologin_cookie({autologinfalse:function(){n.autologin_mac({autologinfalse:function(){}})}}):$("#txt_userloginname").focus()}})},btn_login_password_onclick:function(){r.start();$("#txt_userloginname").removeClass("txt-warning");$("#txt_userpassword").removeClass("txt-warning");var t=$("#txt_userloginname").val().trim(),i=$("#txt_userpassword").val().trim();t==""&&i==""?($("#txt_userloginname").focus(),$("#txt_userloginname").addClass("txt-warning"),$("#txt_userpassword").addClass("txt-warning"),r.stop()):t==""&&i!=""?($("#txt_userloginname").focus(),$("#txt_userloginname").addClass("txt-warning"),r.stop()):t!=""&&i==""?($("#txt_userpassword").focus(),$("#txt_userpassword").addClass("txt-warning"),r.stop()):n.ajaxlogin(t,i,"--",{loginfalse:function(n){r.stop();$("#span_errormessage").html(n)},loginerror:function(n){r.stop();$("#span_errormessage").html(n)}})},btn_login_pattern_onclick:function(){$("#span_errormessage").html("");$("#txt_userloginname").removeClass("txt-warning");$("#txt_userpassword").removeClass("txt-warning");var t=$("#txt_userloginname").val().trim();t==""?($("#txt_userloginname").focus(),$("#txt_userloginname").addClass("txt-warning")):o==null?(o=new PatternLock("#div_pattern_content",{margin:15,onDraw:function(i){n.ajaxlogin(t,"--",i,{loginfalse:function(){o.error()},loginerror:function(n){$("#span_errormessage").html(n)}})}}),setTimeout(function(){$("#div_pattern_modal").modal("show")},100)):(o.reset(),$("#div_pattern_modal").modal("show"))},btn_pattern_modal_close_onclick:function(){$("#div_pattern_modal").modal("hide")},autologinstart:function(){switch(e){case"requestparameter":$("#pietext").html("已识别账户:"+t+"<br/>[参数]自动登录中...");break;case"cookie":$("#pietext").html("已识别账户:"+t+"<br/>[cookie]自动登录中...");break;case"mac":$("#pietext").html("已识别账户:"+t+"<br/>[mac]自动登录中...")}$("#div_autologin_modal").modal("show");$("#div_autologin_modal").attr("style","display:block");$("#piechart").easyPieChart({size:60,lineWidth:5,lineCap:"square",barColor:"#81e970",scaleColor:!1});s=!0;setTimeout(n.setPieChart,200)},btn_autologin_onclick:function(t){t?(i.start(),n.autologinok()):($("#div_autologin_modal").modal("hide"),s=!1)},setPieChart:function(){if(s){var t=parseInt($("#pienumber").html().replace("%",""));t<=0?n.autologinok():(t=t-2,$("#piechart").data("easyPieChart").update(t),$("#pienumber").html(t+"%"),setTimeout(n.setPieChart,200))}},autologinok:function(){switch(e){case"requestparameter":n.ajaxlogin(t,u,"--",{loginfalse:function(n){$("#span_errormessage").html(n);i.stop()},loginerror:function(n){i.stop();$("#span_errormessage").html(n)}});break;case"cookie":n.ajaxlogin(t,"--","--",{loginfalse:function(n){$("#span_errormessage").html(n);i.stop()},loginerror:function(n){i.stop();$("#span_errormessage").html(n)}});break;case"mac":n.ajaxlogin(t,"--","--",{loginfalse:function(n){$("#span_errormessage").html(n);i.stop()},loginerror:function(n){i.stop();$("#span_errormessage").html(n)}})}},ajaxlogin:function(t,i,r,u){var e={userLoginNameString:t,userPasswordString:i,userPatternString:r};doAjaxFunction(f,"UserLogin",e,{success:function(i){setCookie("userloginname",t,30);var r=i.split("^")[0],f=i.split("^")[1];n.cookieUserInf(r,f,{success:function(){window.location.href=commonObj.need2BeInContainer?"../container/container.html?random="+parseInt(1e4*Math.random())+"&foreurl=../main/main.html&uid="+r:"../main/main.html?random="+parseInt(1e4*Math.random())+"&uid="+r},fail:function(n){u.loginfalse(n)}})},fail:function(n){u.loginfalse(n)},error:function(n){u.loginerror(n)}})},cookieUserInf:function(n,t,i){setCookieMinutes("logintype",t,1440);var r={userIdString:n,uuid:""};doAjaxFunction(f,"GetUserInf",r,{success:function(n){var r=new Function("","return "+n)(),u;t!=null&&t!=""&&t=="1"?doAjaxFunction(f,"GetClientInfo",{},{success:function(n){try{var t=new Function("","return "+n)();r.mac=t.mac;r.ip=t.ip;setCookieMinutes("userInf",JSON.stringify(r),1440);i.success()}catch(u){i.fail("GetClientInfo执行失败-catch<br/>"+u.message)}},fail:function(n){i.fail("GetClientInfo执行失败-fail<br/>"+n)},error:function(n){i.fail("GetClientInfo执行失败-error<br/>"+n)}}):r.sys_value4!=null&&r.sys_value4!=""&&r.sys_value5!=null&&r.sys_value5!=""?(u=CheckUKey(r.sys_value4,r.sys_value5),u=="true"?doAjaxFunction(f,"GetClientInfo",{},{success:function(n){try{var t=new Function("","return "+n)();r.mac=t.mac;r.ip=t.ip;setCookieMinutes("userInf",JSON.stringify(r),1440);i.success()}catch(u){i.fail("GetClientInfo执行失败-catch<br/>"+u.message)}},fail:function(n){i.fail("GetClientInfo执行失败-fail<br/>"+n)},error:function(n){i.fail("GetClientInfo执行失败-error<br/>"+n)}}):i.fail("登录失败<br/>"+u)):doAjaxFunction(f,"GetClientInfo",{},{success:function(n){try{var t=new Function("","return "+n)();r.mac=t.mac;r.ip=t.ip;setCookieMinutes("userInf",JSON.stringify(r),1440);i.success()}catch(u){i.fail("GetClientInfo执行失败-catch<br/>"+u.message)}},fail:function(n){i.fail("GetClientInfo执行失败-fail<br/>"+n)},error:function(n){i.fail("GetClientInfo执行失败-error<br/>"+n)}})},fail:function(n){i.fail("initUserInf执行失败-fail<br/>"+n)},error:function(n){i.fail("initUserInf执行失败-error<br/>"+n)}})},autologin_requestparameter:function(i){t=requestQuery("uname");u=requestQuery("upwd");t!=""&&u==""?($("#txt_userloginname").val(t),$("#txt_userpassword").focus(),$("#txt_userpassword").addClass("txt-warning")):t==""&&u!=""?($("#txt_userpassword").val(u),$("#txt_userloginname").focus(),$("#txt_userloginname").addClass("txt-warning")):t!=""&&u!=""?(e="requestparameter",$("#txt_userloginname").val(t),$("#txt_userpassword").val(u),n.autologinstart()):i.autologinfalse()},autologin_cookie:function(i){var r=getCookie("userloginname");r!==null?($("#txt_userloginname").val(r),e="cookie",t=r,n.autologinstart()):i.autologinfalse()},autologin_mac:function(i){doAjaxFunction(f,"GetUserLoginNameByMac",{},{success:function(i){t=i;$("#txt_userloginname").val(t);e="mac";n.autologinstart()},fail:function(){i.autologinfalse()},error:function(){i.autologinfalse()}})}};return n}();$(document).ready(function(){login_Obj.init()});